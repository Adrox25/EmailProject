<html>
<head>
<title>Flex.php</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #a9b7c6;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #629755; font-weight: bold; font-style: italic;}
.s6 { color: #77b767; font-style: italic;}
.s7 { color: #9876aa;}
.s8 { color: #6a8759;}
.s9 { color: #6897bb;}
.ls0 { height: 1px; border-width: 0; color: #4d4d4d; background-color:#4d4d4d}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Flex.php</font>
</center></td></tr></table>
<pre><span class="s0">&lt;?php</span>

<span class="s2">/* 
 * This file is part of the Symfony package. 
 * 
 * (c) Fabien Potencier &lt;fabien@symfony.com&gt; 
 * 
 * For the full copyright and license information, please view the LICENSE 
 * file that was distributed with this source code. 
 */</span>
<hr class="ls0"><span class="s0">namespace </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Flex</span><span class="s0">;</span>

<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Command</span><span class="s1">\</span><span class="s3">GlobalCommand</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Composer</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Console</span><span class="s1">\</span><span class="s3">Application</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">DependencyResolver</span><span class="s1">\</span><span class="s3">Operation</span><span class="s1">\</span><span class="s3">InstallOperation</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">DependencyResolver</span><span class="s1">\</span><span class="s3">Operation</span><span class="s1">\</span><span class="s3">UninstallOperation</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">DependencyResolver</span><span class="s1">\</span><span class="s3">Operation</span><span class="s1">\</span><span class="s3">UpdateOperation</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">DependencyResolver</span><span class="s1">\</span><span class="s3">Pool</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Downloader</span><span class="s1">\</span><span class="s3">FileDownloader</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">EventDispatcher</span><span class="s1">\</span><span class="s3">EventSubscriberInterface</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Factory</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">InstallerEvent</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">InstallerEvents</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">NoopInstaller</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">PackageEvent</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">PackageEvents</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Installer</span><span class="s1">\</span><span class="s3">SuggestedPackagesReporter</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">IO</span><span class="s1">\</span><span class="s3">IOInterface</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">IO</span><span class="s1">\</span><span class="s3">NullIO</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Json</span><span class="s1">\</span><span class="s3">JsonFile</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Json</span><span class="s1">\</span><span class="s3">JsonManipulator</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Package</span><span class="s1">\</span><span class="s3">BasePackage</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Package</span><span class="s1">\</span><span class="s3">Comparer</span><span class="s1">\</span><span class="s3">Comparer</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Package</span><span class="s1">\</span><span class="s3">Locker</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Package</span><span class="s1">\</span><span class="s3">PackageInterface</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Plugin</span><span class="s1">\</span><span class="s3">PluginEvents</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Plugin</span><span class="s1">\</span><span class="s3">PluginInterface</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Plugin</span><span class="s1">\</span><span class="s3">PreFileDownloadEvent</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Repository</span><span class="s1">\</span><span class="s3">ComposerRepository </span><span class="s0">as </span><span class="s3">BaseComposerRepository</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Repository</span><span class="s1">\</span><span class="s3">RepositoryFactory</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Repository</span><span class="s1">\</span><span class="s3">RepositoryManager</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Script</span><span class="s1">\</span><span class="s3">Event</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Composer</span><span class="s1">\</span><span class="s3">Script</span><span class="s1">\</span><span class="s3">ScriptEvents</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Component</span><span class="s1">\</span><span class="s3">Console</span><span class="s1">\</span><span class="s3">Input</span><span class="s1">\</span><span class="s3">ArgvInput</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Flex</span><span class="s1">\</span><span class="s3">Event</span><span class="s1">\</span><span class="s3">UpdateEvent</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Thanks</span><span class="s1">\</span><span class="s3">Thanks</span><span class="s0">;</span>
<hr class="ls0"><span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@author </span><span class="s4">Fabien Potencier </span><span class="s6">&lt;fabien</span><span class="s4">@symfony.com&gt;</span>
 <span class="s4">* </span><span class="s5">@author </span><span class="s4">Nicolas Grekas </span><span class="s6">&lt;p</span><span class="s4">@tchwork.com&gt;</span>
 <span class="s4">*/</span>
<span class="s0">class </span><span class="s3">Flex </span><span class="s0">implements </span><span class="s3">PluginInterface</span><span class="s0">, </span><span class="s3">EventSubscriberInterface</span>
<span class="s1">{</span>
    <span class="s0">private </span><span class="s7">$composer</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$io</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$config</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$options</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$configurator</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$downloader</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$installer</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$postInstallOutput </span><span class="s1">= [</span><span class="s8">''</span><span class="s1">]</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$operations </span><span class="s1">= []</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$lock</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$cacheDirPopulated </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$displayThanksReminder </span><span class="s1">= </span><span class="s9">0</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$rfs</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$progress </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$dryRun </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
    <span class="s0">private static </span><span class="s7">$activated </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
    <span class="s0">private static </span><span class="s7">$repoReadingCommands </span><span class="s1">= [</span>
        <span class="s8">'create-project' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
        <span class="s8">'outdated' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
        <span class="s8">'require' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
        <span class="s8">'update' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
        <span class="s8">'install' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">;</span>
    <span class="s0">private static </span><span class="s7">$aliasResolveCommands </span><span class="s1">= [</span>
        <span class="s8">'require' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
        <span class="s8">'update' </span><span class="s1">=&gt; </span><span class="s3">false</span><span class="s0">,</span>
        <span class="s8">'remove' </span><span class="s1">=&gt; </span><span class="s3">false</span><span class="s0">,</span>
        <span class="s8">'unpack' </span><span class="s1">=&gt; </span><span class="s3">true</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s7">$shouldUpdateComposerLock </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>

    <span class="s0">public function </span><span class="s3">activate</span><span class="s1">(</span><span class="s3">Composer </span><span class="s7">$composer</span><span class="s0">, </span><span class="s3">IOInterface </span><span class="s7">$io</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!\</span><span class="s3">extension_loaded</span><span class="s1">(</span><span class="s8">'openssl'</span><span class="s1">)) {</span>
            <span class="s3">self</span><span class="s1">::</span><span class="s7">$activated </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
            <span class="s7">$io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">'&lt;warning&gt;Symfony Flex has been disabled. You must enable the openssl extension in your &quot;php.ini&quot; file.&lt;/&gt;'</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s2">// to avoid issues when Flex is upgraded, we load all PHP classes now</span>
        <span class="s2">// that way, we are sure to use all classes from the same version</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s0">new </span><span class="s1">\</span><span class="s3">RecursiveIteratorIterator</span><span class="s1">(</span><span class="s0">new </span><span class="s1">\</span><span class="s3">RecursiveDirectoryIterator</span><span class="s1">(</span><span class="s3">__DIR__</span><span class="s0">, </span><span class="s1">\</span><span class="s3">FilesystemIterator</span><span class="s1">::</span><span class="s3">SKIP_DOTS</span><span class="s1">)) </span><span class="s0">as </span><span class="s7">$file</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s8">'.php' </span><span class="s1">=== </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$file</span><span class="s0">, </span><span class="s1">-</span><span class="s9">4</span><span class="s1">)) {</span>
                <span class="s3">class_exists</span><span class="s1">(</span><span class="s3">__NAMESPACE__</span><span class="s1">.</span><span class="s3">str_replace</span><span class="s1">(</span><span class="s8">'/'</span><span class="s0">, </span><span class="s8">'</span><span class="s0">\\</span><span class="s8">'</span><span class="s0">, </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$file</span><span class="s0">, </span><span class="s1">\</span><span class="s3">strlen</span><span class="s1">(</span><span class="s3">__DIR__</span><span class="s1">)</span><span class="s0">, </span><span class="s1">-</span><span class="s9">4</span><span class="s1">)))</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer </span><span class="s1">= </span><span class="s7">$composer</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io </span><span class="s1">= </span><span class="s7">$io</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config </span><span class="s1">= </span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getConfig</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">initOptions</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s7">$rfs </span><span class="s1">= </span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">createRemoteFilesystem</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ParallelDownloader</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s0">, </span><span class="s7">$rfs</span><span class="s1">-&gt;</span><span class="s3">getOptions</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$rfs</span><span class="s1">-&gt;</span><span class="s3">isTlsDisabled</span><span class="s1">())</span><span class="s0">;</span>

        <span class="s7">$symfonyRequire </span><span class="s1">= </span><span class="s3">getenv</span><span class="s1">(</span><span class="s8">'SYMFONY_REQUIRE'</span><span class="s1">) ?: (</span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getExtra</span><span class="s1">()[</span><span class="s8">'symfony'</span><span class="s1">][</span><span class="s8">'require'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader </span><span class="s1">= </span><span class="s7">$downloader </span><span class="s1">= </span><span class="s0">new </span><span class="s3">Downloader</span><span class="s1">(</span><span class="s7">$composer</span><span class="s0">, </span><span class="s7">$io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">setFlexId</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">getFlexId</span><span class="s1">())</span><span class="s0">;</span>

        <span class="s7">$manager </span><span class="s1">= </span><span class="s3">RepositoryFactory</span><span class="s1">::</span><span class="s3">manager</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s0">, </span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getEventDispatcher</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$setRepositories </span><span class="s1">= \</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s0">function </span><span class="s1">(</span><span class="s3">RepositoryManager </span><span class="s7">$manager</span><span class="s1">) </span><span class="s0">use </span><span class="s1">(&amp;</span><span class="s7">$symfonyRequire</span><span class="s0">, </span><span class="s7">$downloader</span><span class="s1">) {</span>
            <span class="s7">$manager</span><span class="s1">-&gt;</span><span class="s3">repositoryClasses </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">repositoryClasses</span><span class="s0">;</span>
            <span class="s7">$manager</span><span class="s1">-&gt;</span><span class="s3">setRepositoryClass</span><span class="s1">(</span><span class="s8">'composer'</span><span class="s0">, </span><span class="s3">TruncatedComposerRepository</span><span class="s1">::</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s7">$manager</span><span class="s1">-&gt;</span><span class="s3">repositories </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">repositories</span><span class="s0">;</span>
            <span class="s7">$i </span><span class="s1">= </span><span class="s9">0</span><span class="s0">;</span>
            <span class="s0">foreach </span><span class="s1">(</span><span class="s3">RepositoryFactory</span><span class="s1">::</span><span class="s3">defaultRepos</span><span class="s1">(</span><span class="s3">null</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s0">, </span><span class="s7">$manager</span><span class="s1">) </span><span class="s0">as </span><span class="s7">$repo</span><span class="s1">) {</span>
                <span class="s7">$manager</span><span class="s1">-&gt;</span><span class="s3">repositories</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">++] = </span><span class="s7">$repo</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s7">$repo </span><span class="s0">instanceof </span><span class="s3">TruncatedComposerRepository </span><span class="s1">&amp;&amp; </span><span class="s7">$symfonyRequire</span><span class="s1">) {</span>
                    <span class="s7">$repo</span><span class="s1">-&gt;</span><span class="s3">setSymfonyRequire</span><span class="s1">(</span><span class="s7">$symfonyRequire</span><span class="s0">, </span><span class="s7">$downloader</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
            <span class="s7">$manager</span><span class="s1">-&gt;</span><span class="s3">setLocalRepository</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">getLocalRepository</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s1">}</span><span class="s0">, </span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getRepositoryManager</span><span class="s1">()</span><span class="s0">, </span><span class="s3">RepositoryManager</span><span class="s1">::</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s7">$setRepositories</span><span class="s1">(</span><span class="s7">$manager</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">setRepositoryManager</span><span class="s1">(</span><span class="s7">$manager</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">configurator </span><span class="s1">= </span><span class="s0">new </span><span class="s3">Configurator</span><span class="s1">(</span><span class="s7">$composer</span><span class="s0">, </span><span class="s7">$io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock </span><span class="s1">= </span><span class="s0">new </span><span class="s3">Lock</span><span class="s1">(</span><span class="s3">getenv</span><span class="s1">(</span><span class="s8">'SYMFONY_LOCKFILE'</span><span class="s1">) ?: </span><span class="s3">str_replace</span><span class="s1">(</span><span class="s8">'composer.json'</span><span class="s0">, </span><span class="s8">'symfony.lock'</span><span class="s0">, </span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">()))</span><span class="s0">;</span>

        <span class="s7">$disable </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s3">array_merge</span><span class="s1">(</span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getRequires</span><span class="s1">() ?? []</span><span class="s0">, </span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getDevRequires</span><span class="s1">() ?? []) </span><span class="s0">as </span><span class="s7">$link</span><span class="s1">) {</span>
            <span class="s2">// recipes apply only when symfony/flex is found in &quot;require&quot; or &quot;require-dev&quot; in the root package</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s8">'symfony/flex' </span><span class="s1">=== </span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getTarget</span><span class="s1">()) {</span>
                <span class="s7">$disable </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
                <span class="s0">break;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$disable</span><span class="s1">) {</span>
            <span class="s7">$downloader</span><span class="s1">-&gt;</span><span class="s3">disable</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$populateRepoCacheDir </span><span class="s1">= </span><span class="s3">__CLASS__ </span><span class="s1">=== </span><span class="s3">self</span><span class="s1">::</span><span class="s0">class;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getPluginManager</span><span class="s1">()) {</span>
            <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$composer</span><span class="s1">-&gt;</span><span class="s3">getPluginManager</span><span class="s1">()-&gt;</span><span class="s3">getPlugins</span><span class="s1">() </span><span class="s0">as </span><span class="s7">$plugin</span><span class="s1">) {</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s9">0 </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(\</span><span class="s3">get_class</span><span class="s1">(</span><span class="s7">$plugin</span><span class="s1">)</span><span class="s0">, </span><span class="s8">'Hirak\Prestissimo\Plugin'</span><span class="s1">)) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s3">method_exists</span><span class="s1">(</span><span class="s7">$rfs</span><span class="s0">, </span><span class="s8">'getRemoteContents'</span><span class="s1">)) {</span>
                        <span class="s7">$plugin</span><span class="s1">-&gt;</span><span class="s3">disable</span><span class="s1">()</span><span class="s0">;</span>
                    <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s7">$populateRepoCacheDir </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
                    <span class="s0">break;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s7">$backtrace </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">configureInstaller</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$backtrace </span><span class="s0">as </span><span class="s7">$trace</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(!</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]) || !</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'args'</span><span class="s1">][</span><span class="s9">0</span><span class="s1">])) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">] </span><span class="s0">instanceof </span><span class="s3">Application </span><span class="s1">|| !</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'args'</span><span class="s1">][</span><span class="s9">0</span><span class="s1">] </span><span class="s0">instanceof </span><span class="s3">ArgvInput</span><span class="s1">) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s2">// In Composer 1.0.*, $input knows about option and argument definitions</span>
            <span class="s2">// Since Composer &gt;=1.1, $input contains only raw values</span>
            <span class="s7">$input </span><span class="s1">= </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'args'</span><span class="s1">][</span><span class="s9">0</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s7">$app </span><span class="s1">= </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]</span><span class="s0">;</span>

            <span class="s7">$resolver </span><span class="s1">= </span><span class="s0">new </span><span class="s3">PackageResolver</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s3">version_compare</span><span class="s1">(</span><span class="s8">'1.1.0'</span><span class="s0">, </span><span class="s3">PluginInterface</span><span class="s1">::</span><span class="s3">PLUGIN_API_VERSION</span><span class="s0">, </span><span class="s8">'&gt;'</span><span class="s1">)) {</span>
                <span class="s7">$note </span><span class="s1">= </span><span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">has</span><span class="s1">(</span><span class="s8">'self-update'</span><span class="s1">) ? </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'`php %s self-update`'</span><span class="s0">, </span><span class="s7">$_SERVER</span><span class="s1">[</span><span class="s8">'argv'</span><span class="s1">][</span><span class="s9">0</span><span class="s1">]) : </span><span class="s8">'https://getcomposer.org/'</span><span class="s0">;</span>
                <span class="s7">$io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">'&lt;warning&gt;Some Symfony Flex features may not work as expected: your version of Composer is too old&lt;/&gt;'</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s7">$io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'&lt;warning&gt;Please upgrade using %s&lt;/&gt;'</span><span class="s0">, </span><span class="s7">$note</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">try </span><span class="s1">{</span>
                <span class="s7">$command </span><span class="s1">= </span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">getFirstArgument</span><span class="s1">()</span><span class="s0">;</span>
                <span class="s7">$command </span><span class="s1">= </span><span class="s7">$command </span><span class="s1">? </span><span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">find</span><span class="s1">(</span><span class="s7">$command</span><span class="s1">)-&gt;</span><span class="s3">getName</span><span class="s1">() : </span><span class="s3">null</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">catch </span><span class="s1">(\</span><span class="s3">InvalidArgumentException </span><span class="s7">$e</span><span class="s1">) {</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s8">'create-project' </span><span class="s1">=== </span><span class="s7">$command</span><span class="s1">) {</span>
                <span class="s2">// detect Composer &gt;=1.7 (using the Composer::VERSION constant doesn't work with snapshot builds)</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s3">class_exists</span><span class="s1">(</span><span class="s3">Comparer</span><span class="s1">::</span><span class="s0">class</span><span class="s1">)) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasOption</span><span class="s1">(</span><span class="s8">'remove-vcs'</span><span class="s1">)) {</span>
                        <span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">setOption</span><span class="s1">(</span><span class="s8">'remove-vcs'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s1">}</span>
                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">setInteractive</span><span class="s1">(</span><span class="s3">false</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s7">$populateRepoCacheDir </span><span class="s1">= </span><span class="s7">$populateRepoCacheDir </span><span class="s1">&amp;&amp; !</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasOption</span><span class="s1">(</span><span class="s8">'remove-vcs'</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s8">'update' </span><span class="s1">=== </span><span class="s7">$command</span><span class="s1">) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">displayThanksReminder </span><span class="s1">= </span><span class="s9">1</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s8">'outdated' </span><span class="s1">=== </span><span class="s7">$command</span><span class="s1">) {</span>
                <span class="s7">$symfonyRequire </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
                <span class="s7">$setRepositories</span><span class="s1">(</span><span class="s7">$manager</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$aliasResolveCommands</span><span class="s1">[</span><span class="s7">$command</span><span class="s1">])) {</span>
                <span class="s2">// early resolve for BC with Composer 1.0</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasArgument</span><span class="s1">(</span><span class="s8">'packages'</span><span class="s1">)) {</span>
                    <span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">setArgument</span><span class="s1">(</span><span class="s8">'packages'</span><span class="s0">, </span><span class="s7">$resolver</span><span class="s1">-&gt;</span><span class="s3">resolve</span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">getArgument</span><span class="s1">(</span><span class="s8">'packages'</span><span class="s1">)</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$aliasResolveCommands</span><span class="s1">[</span><span class="s7">$command</span><span class="s1">]))</span><span class="s0">;</span>
                <span class="s1">}</span>

                <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasOption</span><span class="s1">(</span><span class="s8">'no-suggest'</span><span class="s1">)) {</span>
                    <span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">setOption</span><span class="s1">(</span><span class="s8">'no-suggest'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasParameterOption</span><span class="s1">(</span><span class="s8">'--no-progress'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">progress </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasParameterOption</span><span class="s1">(</span><span class="s8">'--dry-run'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">dryRun </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s7">$input</span><span class="s1">-&gt;</span><span class="s3">hasParameterOption</span><span class="s1">(</span><span class="s8">'--prefer-lowest'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)) {</span>
                <span class="s2">// When prefer-lowest is set and no stable version has been released,</span>
                <span class="s2">// we consider &quot;dev&quot; more stable than &quot;alpha&quot;, &quot;beta&quot; or &quot;RC&quot;. This</span>
                <span class="s2">// allows testing lowest versions with potential fixes applied.</span>
                <span class="s3">BasePackage</span><span class="s1">::</span><span class="s7">$stabilities</span><span class="s1">[</span><span class="s8">'dev'</span><span class="s1">] = </span><span class="s9">1 </span><span class="s1">+ </span><span class="s3">BasePackage</span><span class="s1">::</span><span class="s3">STABILITY_STABLE</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s7">$composerFile </span><span class="s1">= </span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s7">$populateRepoCacheDir </span><span class="s1">&amp;&amp; </span><span class="s0">isset</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$repoReadingCommands</span><span class="s1">[</span><span class="s7">$command</span><span class="s1">]) &amp;&amp; (</span><span class="s8">'install' </span><span class="s1">!== </span><span class="s7">$command </span><span class="s1">|| (</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s7">$composerFile</span><span class="s1">) &amp;&amp; !</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$composerFile</span><span class="s0">, </span><span class="s9">0</span><span class="s0">, </span><span class="s1">-</span><span class="s9">4</span><span class="s1">).</span><span class="s8">'lock'</span><span class="s1">)))) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">populateRepoCacheDir</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">RequireCommand</span><span class="s1">(</span><span class="s7">$resolver</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">UpdateCommand</span><span class="s1">(</span><span class="s7">$resolver</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">RemoveCommand</span><span class="s1">(</span><span class="s7">$resolver</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">UnpackCommand</span><span class="s1">(</span><span class="s7">$resolver</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">RecipesCommand</span><span class="s1">(</span><span class="s7">$this</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">InstallRecipesCommand</span><span class="s1">(</span><span class="s7">$this</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'root-dir'</span><span class="s1">)))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">GenerateIdCommand</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$app</span><span class="s1">-&gt;</span><span class="s3">add</span><span class="s1">(</span><span class="s0">new </span><span class="s3">Command</span><span class="s1">\</span><span class="s3">DumpEnvCommand</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">))</span><span class="s0">;</span>

            <span class="s0">break;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">configureInstaller</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s7">$backtrace </span><span class="s1">= </span><span class="s3">debug_backtrace</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$backtrace </span><span class="s0">as </span><span class="s7">$trace</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]) &amp;&amp; </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">] </span><span class="s0">instanceof </span><span class="s3">Installer</span><span class="s1">) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer </span><span class="s1">= \</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s0">function </span><span class="s1">() { </span><span class="s0">return </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">update </span><span class="s1">? </span><span class="s7">$this </span><span class="s1">: </span><span class="s3">null</span><span class="s0">; </span><span class="s1">}</span><span class="s0">, </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">])()</span><span class="s0">;</span>
                <span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]-&gt;</span><span class="s3">setSuggestedPackagesReporter</span><span class="s1">(</span><span class="s0">new </span><span class="s3">SuggestedPackagesReporter</span><span class="s1">(</span><span class="s0">new </span><span class="s3">NullIO</span><span class="s1">()))</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">]) &amp;&amp; </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">'object'</span><span class="s1">] </span><span class="s0">instanceof </span><span class="s3">GlobalCommand</span><span class="s1">) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">disable</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s7">$backtrace</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">lockPlatform</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">isEnabled</span><span class="s1">()) {</span>
            <span class="s0">return; </span><span class="s2">// &quot;symfony/flex&quot; not found in the root composer.json - don't create the symfony.lock file</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">set</span><span class="s1">(</span><span class="s8">'php'</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s8">'version' </span><span class="s1">=&gt; </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'platform'</span><span class="s1">)[</span><span class="s8">'php'</span><span class="s1">] ?? (</span><span class="s3">PHP_MAJOR_VERSION</span><span class="s1">.</span><span class="s8">'.'</span><span class="s1">.</span><span class="s3">PHP_MINOR_VERSION</span><span class="s1">)</span><span class="s0">,</span>
        <span class="s1">])</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">configureProject</span><span class="s1">(</span><span class="s3">Event </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">isEnabled</span><span class="s1">()) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">'&lt;warning&gt;Project configuration is disabled: &quot;symfony/flex&quot; not found in the root composer.json&lt;/&gt;'</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$json </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonFile</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s7">$contents </span><span class="s1">= </span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s7">$manipulator </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonManipulator</span><span class="s1">(</span><span class="s7">$contents</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s2">// new projects are most of the time proprietary</span>
        <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">addMainKey</span><span class="s1">(</span><span class="s8">'license'</span><span class="s0">, </span><span class="s8">'proprietary'</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s2">// replace unbounded constraints for symfony/* packages by extra.symfony.require</span>
        <span class="s7">$config </span><span class="s1">= </span><span class="s3">json_decode</span><span class="s1">(</span><span class="s7">$contents</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$symfonyVersion </span><span class="s1">= </span><span class="s7">$config</span><span class="s1">[</span><span class="s8">'extra'</span><span class="s1">][</span><span class="s8">'symfony'</span><span class="s1">][</span><span class="s8">'require'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s1">) {</span>
            <span class="s7">$versions </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">getVersions</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s0">foreach </span><span class="s1">([</span><span class="s8">'require'</span><span class="s0">, </span><span class="s8">'require-dev'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$type</span><span class="s1">) {</span>
                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$config</span><span class="s1">[</span><span class="s7">$type</span><span class="s1">] ?? [] </span><span class="s0">as </span><span class="s7">$package </span><span class="s1">=&gt; </span><span class="s7">$version</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s8">'*' </span><span class="s1">=== </span><span class="s7">$version </span><span class="s1">&amp;&amp; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$versions</span><span class="s1">[</span><span class="s8">'splits'</span><span class="s1">][</span><span class="s7">$package</span><span class="s1">])) {</span>
                        <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">addLink</span><span class="s1">(</span><span class="s7">$type</span><span class="s0">, </span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$symfonyVersion</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s2">// 'name' and 'description' are only required for public packages</span>
        <span class="s2">// don't use $manipulator-&gt;removeProperty() for BC with Composer 1.0</span>
        <span class="s7">$contents </span><span class="s1">= </span><span class="s3">preg_replace</span><span class="s1">([</span><span class="s8">'{^\s*+&quot;name&quot;:.*,$\n}m'</span><span class="s0">, </span><span class="s8">'{^\s*+&quot;description&quot;:.*,$\n}m'</span><span class="s1">]</span><span class="s0">, </span><span class="s8">''</span><span class="s0">, </span><span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">getContents</span><span class="s1">()</span><span class="s0">, </span><span class="s9">1</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s3">file_put_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$contents</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">updateComposerLock</span><span class="s1">()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">record</span><span class="s1">(</span><span class="s3">PackageEvent </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">shouldRecordOperation</span><span class="s1">(</span><span class="s7">$event</span><span class="s1">)) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">operations</span><span class="s1">[] = </span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getOperation</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">checkForUpdate</span><span class="s1">(</span><span class="s3">PackageEvent </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer </span><span class="s1">|| </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">|| </span><span class="s8">'symfony/flex' </span><span class="s1">!== </span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getOperation</span><span class="s1">()-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getName</span><span class="s1">()) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">update</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getInstallationManager</span><span class="s1">()-&gt;</span><span class="s3">addInstaller</span><span class="s1">(</span><span class="s0">new </span><span class="s3">NoopInstaller</span><span class="s1">())</span><span class="s0">;</span>

        <span class="s1">\</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s0">function </span><span class="s1">() {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io </span><span class="s1">= </span><span class="s0">new </span><span class="s3">NullIO</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">writeLock </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">executeOperations </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">dumpAutoloader </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">runScripts </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
        <span class="s1">}</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer</span><span class="s1">)()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">update</span><span class="s1">(</span><span class="s3">Event </span><span class="s7">$event </span><span class="s1">= </span><span class="s3">null</span><span class="s0">, </span><span class="s7">$operations </span><span class="s1">= [])</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$operations</span><span class="s1">) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">operations </span><span class="s1">= </span><span class="s7">$operations</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">install</span><span class="s1">(</span><span class="s7">$event</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s7">$jsonPath </span><span class="s1">= </span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$json </span><span class="s1">= </span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$jsonPath</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$manipulator </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonManipulator</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$json </span><span class="s1">= </span><span class="s3">json_decode</span><span class="s1">(</span><span class="s7">$json</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$event</span><span class="s1">) {</span>
            <span class="s2">// called from checkForUpdate()</span>
        <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer </span><span class="s1">|| (!</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">[</span><span class="s8">'flex-require'</span><span class="s1">]) &amp;&amp; !</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">[</span><span class="s8">'flex-require-dev'</span><span class="s1">]))) {</span>
            <span class="s0">return;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">stopPropagation</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$sortPackages </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getConfig</span><span class="s1">()-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'sort-packages'</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">([</span><span class="s8">'require'</span><span class="s0">, </span><span class="s8">'require-dev'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$type</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">[</span><span class="s8">'flex-'</span><span class="s1">.</span><span class="s7">$type</span><span class="s1">])) {</span>
                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$json</span><span class="s1">[</span><span class="s8">'flex-'</span><span class="s1">.</span><span class="s7">$type</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$package </span><span class="s1">=&gt; </span><span class="s7">$constraint</span><span class="s1">) {</span>
                    <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">addLink</span><span class="s1">(</span><span class="s7">$type</span><span class="s0">, </span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$constraint</span><span class="s0">, </span><span class="s7">$sortPackages</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>

                <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">removeMainKey</span><span class="s1">(</span><span class="s8">'flex-'</span><span class="s1">.</span><span class="s7">$type</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s3">file_put_contents</span><span class="s1">(</span><span class="s7">$jsonPath</span><span class="s0">, </span><span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">getContents</span><span class="s1">())</span><span class="s0">;</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>
        <span class="s7">$rm </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getRepositoryManager</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$package </span><span class="s1">= </span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">create</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">)-&gt;</span><span class="s3">getPackage</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">setPackage</span><span class="s1">(</span><span class="s7">$package</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">\</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s0">function </span><span class="s1">() </span><span class="s0">use </span><span class="s1">(</span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$rm</span><span class="s1">) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">package </span><span class="s1">= </span><span class="s7">$package</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">repositoryManager </span><span class="s1">= </span><span class="s7">$rm</span><span class="s0">;</span>
        <span class="s1">}</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer</span><span class="s1">)()</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getEventDispatcher</span><span class="s1">()-&gt;</span><span class="s3">__construct</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s7">$status </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">installer</span><span class="s1">-&gt;</span><span class="s3">run</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s9">0 </span><span class="s1">!== </span><span class="s7">$status</span><span class="s1">) {</span>
            <span class="s0">exit</span><span class="s1">(</span><span class="s7">$status</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">install</span><span class="s1">(</span><span class="s3">Event </span><span class="s7">$event </span><span class="s1">= </span><span class="s3">null</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s7">$rootDir </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'root-dir'</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(!</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s8">&quot;</span><span class="s7">$rootDir</span><span class="s8">/.env&quot;</span><span class="s1">) &amp;&amp; !</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s8">&quot;</span><span class="s7">$rootDir</span><span class="s8">/.env.local&quot;</span><span class="s1">) &amp;&amp; </span><span class="s3">file_exists</span><span class="s1">(</span><span class="s8">&quot;</span><span class="s7">$rootDir</span><span class="s8">/.env.dist&quot;</span><span class="s1">) &amp;&amp; </span><span class="s3">false </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s8">&quot;</span><span class="s7">$rootDir</span><span class="s8">/.env.dist&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s8">'.env.local'</span><span class="s1">)) {</span>
            <span class="s3">copy</span><span class="s1">(</span><span class="s7">$rootDir</span><span class="s1">.</span><span class="s8">'/.env.dist'</span><span class="s0">, </span><span class="s7">$rootDir</span><span class="s1">.</span><span class="s8">'/.env'</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$recipes </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">fetchRecipes</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">operations</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">operations </span><span class="s1">= []</span><span class="s0">;     </span><span class="s2">// Reset the operation after getting recipes</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s9">2 </span><span class="s1">=== </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">displayThanksReminder</span><span class="s1">) {</span>
            <span class="s7">$love </span><span class="s1">= </span><span class="s8">'</span><span class="s0">\\</span><span class="s8">' </span><span class="s1">=== \</span><span class="s3">DIRECTORY_SEPARATOR </span><span class="s1">? </span><span class="s8">'love' </span><span class="s1">: </span><span class="s8">'💖 '</span><span class="s0">;</span>
            <span class="s7">$star </span><span class="s1">= </span><span class="s8">'</span><span class="s0">\\</span><span class="s8">' </span><span class="s1">=== \</span><span class="s3">DIRECTORY_SEPARATOR </span><span class="s1">? </span><span class="s8">'star' </span><span class="s1">: </span><span class="s8">'★ '</span><span class="s0">;</span>

            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">''</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">'What about running &lt;comment&gt;composer global require symfony/thanks &amp;&amp; composer thanks&lt;/&gt; now?'</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'This will spread some %s by sending a %s to the GitHub repositories of your fellow package maintainers.'</span><span class="s0">, </span><span class="s7">$love</span><span class="s0">, </span><span class="s7">$star</span><span class="s1">))</span><span class="s0">;</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">''</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$recipes</span><span class="s1">) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">write</span><span class="s1">()</span><span class="s0">;</span>

            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'&lt;info&gt;Symfony operations: %d recipe%s (%s)&lt;/&gt;'</span><span class="s0">, </span><span class="s1">\</span><span class="s3">count</span><span class="s1">(</span><span class="s7">$recipes</span><span class="s1">)</span><span class="s0">, </span><span class="s1">\</span><span class="s3">count</span><span class="s1">(</span><span class="s7">$recipes</span><span class="s1">) &gt; </span><span class="s9">1 </span><span class="s1">? </span><span class="s8">'s' </span><span class="s1">: </span><span class="s8">''</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">getSessionId</span><span class="s1">()))</span><span class="s0">;</span>
        <span class="s7">$installContribs </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getExtra</span><span class="s1">()[</span><span class="s8">'symfony'</span><span class="s1">][</span><span class="s8">'allow-contrib'</span><span class="s1">] ?? </span><span class="s3">false</span><span class="s0">;</span>
        <span class="s7">$manifest </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$recipes </span><span class="s0">as </span><span class="s7">$recipe</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s8">'install' </span><span class="s1">=== </span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getJob</span><span class="s1">() &amp;&amp; !</span><span class="s7">$installContribs </span><span class="s1">&amp;&amp; </span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">isContrib</span><span class="s1">()) {</span>
                <span class="s7">$warning </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">isInteractive</span><span class="s1">() ? </span><span class="s8">'WARNING' </span><span class="s1">: </span><span class="s8">'IGNORING'</span><span class="s0">;</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'  - &lt;warning&gt; %s &lt;/&gt; %s'</span><span class="s0">, </span><span class="s7">$warning</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">formatOrigin</span><span class="s1">(</span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getOrigin</span><span class="s1">())))</span><span class="s0">;</span>
                <span class="s7">$question </span><span class="s1">= </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'    The recipe for this package comes from the &quot;contrib&quot; repository, which is open to community contributions. 
    Review the recipe at %s 
 
    Do you want to execute this recipe? 
    [&lt;comment&gt;y&lt;/&gt;] Yes 
    [&lt;comment&gt;n&lt;/&gt;] No 
    [&lt;comment&gt;a&lt;/&gt;] Yes for all packages, only for the current installation session 
    [&lt;comment&gt;p&lt;/&gt;] Yes permanently, never ask again for this project 
    (defaults to &lt;comment&gt;n&lt;/&gt;): '</span><span class="s0">, </span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getURL</span><span class="s1">())</span><span class="s0">;</span>
                <span class="s7">$answer </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">askAndValidate</span><span class="s1">(</span>
                    <span class="s7">$question</span><span class="s0">,</span>
                    <span class="s0">function </span><span class="s1">(</span><span class="s7">$value</span><span class="s1">) {</span>
                        <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$value</span><span class="s1">) {</span>
                            <span class="s0">return </span><span class="s8">'n'</span><span class="s0">;</span>
                        <span class="s1">}</span>
                        <span class="s7">$value </span><span class="s1">= </span><span class="s3">strtolower</span><span class="s1">(</span><span class="s7">$value</span><span class="s1">[</span><span class="s9">0</span><span class="s1">])</span><span class="s0">;</span>
                        <span class="s0">if </span><span class="s1">(!\</span><span class="s3">in_array</span><span class="s1">(</span><span class="s7">$value</span><span class="s0">, </span><span class="s1">[</span><span class="s8">'y'</span><span class="s0">, </span><span class="s8">'n'</span><span class="s0">, </span><span class="s8">'a'</span><span class="s0">, </span><span class="s8">'p'</span><span class="s1">])) {</span>
                            <span class="s0">throw new </span><span class="s1">\</span><span class="s3">InvalidArgumentException</span><span class="s1">(</span><span class="s8">'Invalid choice.'</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s1">}</span>

                        <span class="s0">return </span><span class="s7">$value</span><span class="s0">;</span>
                    <span class="s1">}</span><span class="s0">,</span>
                    <span class="s3">null</span><span class="s0">,</span>
                    <span class="s8">'n'</span>
                <span class="s1">)</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s8">'n' </span><span class="s1">=== </span><span class="s7">$answer</span><span class="s1">) {</span>
                    <span class="s0">continue;</span>
                <span class="s1">}</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s8">'a' </span><span class="s1">=== </span><span class="s7">$answer</span><span class="s1">) {</span>
                    <span class="s7">$installContribs </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s8">'p' </span><span class="s1">=== </span><span class="s7">$answer</span><span class="s1">) {</span>
                    <span class="s7">$installContribs </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
                    <span class="s7">$json </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonFile</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">())</span><span class="s0">;</span>
                    <span class="s7">$manipulator </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonManipulator</span><span class="s1">(</span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">()))</span><span class="s0">;</span>
                    <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">addSubNode</span><span class="s1">(</span><span class="s8">'extra'</span><span class="s0">, </span><span class="s8">'symfony.allow-contrib'</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s3">file_put_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">getContents</span><span class="s1">())</span><span class="s0">;</span>
                    <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">shouldUpdateComposerLock </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>

            <span class="s0">switch </span><span class="s1">(</span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getJob</span><span class="s1">()) {</span>
                <span class="s0">case </span><span class="s8">'install'</span><span class="s1">:</span>
                    <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'  - Configuring %s'</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">formatOrigin</span><span class="s1">(</span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getOrigin</span><span class="s1">())))</span><span class="s0">;</span>
                    <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">configurator</span><span class="s1">-&gt;</span><span class="s3">install</span><span class="s1">(</span><span class="s7">$recipe</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s0">, </span><span class="s1">[</span>
                        <span class="s8">'force' </span><span class="s1">=&gt; </span><span class="s7">$event </span><span class="s0">instanceof </span><span class="s3">UpdateEvent </span><span class="s1">&amp;&amp; </span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">force</span><span class="s1">()</span><span class="s0">,</span>
                    <span class="s1">])</span><span class="s0">;</span>
                    <span class="s7">$manifest </span><span class="s1">= </span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getManifest</span><span class="s1">()</span><span class="s0">;</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$manifest</span><span class="s1">[</span><span class="s8">'post-install-output'</span><span class="s1">])) {</span>
                        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$manifest</span><span class="s1">[</span><span class="s8">'post-install-output'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$line</span><span class="s1">) {</span>
                            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">postInstallOutput</span><span class="s1">[] = </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">-&gt;</span><span class="s3">expandTargetDir</span><span class="s1">(</span><span class="s7">$line</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s1">}</span>
                        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">postInstallOutput</span><span class="s1">[] = </span><span class="s8">''</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">break;</span>
                <span class="s0">case </span><span class="s8">'update'</span><span class="s1">:</span>
                    <span class="s0">break;</span>
                <span class="s0">case </span><span class="s8">'uninstall'</span><span class="s1">:</span>
                    <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'  - Unconfiguring %s'</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">formatOrigin</span><span class="s1">(</span><span class="s7">$recipe</span><span class="s1">-&gt;</span><span class="s3">getOrigin</span><span class="s1">())))</span><span class="s0">;</span>
                    <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">configurator</span><span class="s1">-&gt;</span><span class="s3">unconfigure</span><span class="s1">(</span><span class="s7">$recipe</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s0">break;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">!== </span><span class="s7">$manifest</span><span class="s1">) {</span>
            <span class="s3">array_unshift</span><span class="s1">(</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">postInstallOutput</span><span class="s0">,</span>
                <span class="s8">''</span><span class="s0">,</span>
                <span class="s8">'&lt;info&gt;Some files may have been created or updated to configure your new packages.&lt;/&gt;'</span><span class="s0">,</span>
                <span class="s8">'Please &lt;comment&gt;review&lt;/&gt;, &lt;comment&gt;edit&lt;/&gt; and &lt;comment&gt;commit&lt;/&gt; them: these files are &lt;comment&gt;yours&lt;/&gt;.'</span>
            <span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">write</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">shouldUpdateComposerLock</span><span class="s1">) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">updateComposerLock</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">enableThanksReminder</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s9">1 </span><span class="s1">=== </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">displayThanksReminder</span><span class="s1">) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">displayThanksReminder </span><span class="s1">= !</span><span class="s3">class_exists</span><span class="s1">(</span><span class="s3">Thanks</span><span class="s1">::</span><span class="s0">class, </span><span class="s3">false</span><span class="s1">) &amp;&amp; </span><span class="s3">version_compare</span><span class="s1">(</span><span class="s8">'1.1.0'</span><span class="s0">, </span><span class="s3">PluginInterface</span><span class="s1">::</span><span class="s3">PLUGIN_API_VERSION</span><span class="s0">, </span><span class="s8">'&lt;='</span><span class="s1">) ? </span><span class="s9">2 </span><span class="s1">: </span><span class="s9">0</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">executeAutoScripts</span><span class="s1">(</span><span class="s3">Event </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">stopPropagation</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s2">// force reloading scripts as we might have added and removed during this run</span>
        <span class="s7">$json </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonFile</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s7">$jsonContents </span><span class="s1">= </span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">read</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s7">$executor </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ScriptExecutor</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">options</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$jsonContents</span><span class="s1">[</span><span class="s8">'scripts'</span><span class="s1">][</span><span class="s8">'auto-scripts'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$cmd </span><span class="s1">=&gt; </span><span class="s7">$type</span><span class="s1">) {</span>
            <span class="s7">$executor</span><span class="s1">-&gt;</span><span class="s3">execute</span><span class="s1">(</span><span class="s7">$type</span><span class="s0">, </span><span class="s7">$cmd</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">write</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">postInstallOutput</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">populateProvidersCacheDir</span><span class="s1">(</span><span class="s3">InstallerEvent </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s7">$listed </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s7">$packages </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s7">$pool </span><span class="s1">= </span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getPool</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$pool </span><span class="s1">= \</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s0">function </span><span class="s1">() {</span>
            <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">providerRepos </span><span class="s0">as </span><span class="s7">$k </span><span class="s1">=&gt; </span><span class="s7">$repo</span><span class="s1">) {</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">providerRepos</span><span class="s1">[</span><span class="s7">$k</span><span class="s1">] = </span><span class="s0">new class</span><span class="s1">(</span><span class="s7">$repo</span><span class="s1">) </span><span class="s0">extends </span><span class="s3">BaseComposerRepository </span><span class="s1">{</span>
                    <span class="s0">private </span><span class="s7">$repo</span><span class="s0">;</span>

                    <span class="s0">public function </span><span class="s3">__construct</span><span class="s1">(</span><span class="s7">$repo</span><span class="s1">)</span>
                    <span class="s1">{</span>
                        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">repo </span><span class="s1">= </span><span class="s7">$repo</span><span class="s0">;</span>
                    <span class="s1">}</span>

                    <span class="s0">public function </span><span class="s3">whatProvides</span><span class="s1">(</span><span class="s3">Pool </span><span class="s7">$pool</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$bypassFilters </span><span class="s1">= </span><span class="s3">false</span><span class="s1">)</span>
                    <span class="s1">{</span>
                        <span class="s7">$packages </span><span class="s1">= []</span><span class="s0">;</span>
                        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">repo</span><span class="s1">-&gt;</span><span class="s3">whatProvides</span><span class="s1">(</span><span class="s7">$pool</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$bypassFilters</span><span class="s1">) </span><span class="s0">as </span><span class="s7">$k </span><span class="s1">=&gt; </span><span class="s7">$p</span><span class="s1">) {</span>
                            <span class="s7">$packages</span><span class="s1">[</span><span class="s7">$k</span><span class="s1">] = </span><span class="s0">clone </span><span class="s7">$p</span><span class="s0">;</span>
                        <span class="s1">}</span>

                        <span class="s0">return </span><span class="s7">$packages</span><span class="s0">;</span>
                    <span class="s1">}</span>
                <span class="s1">}</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">return </span><span class="s7">$this</span><span class="s0">;</span>
        <span class="s1">}</span><span class="s0">, clone </span><span class="s7">$pool</span><span class="s0">, </span><span class="s7">$pool</span><span class="s1">)()</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getRequest</span><span class="s1">()-&gt;</span><span class="s3">getJobs</span><span class="s1">() </span><span class="s0">as </span><span class="s7">$job</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s8">'install' </span><span class="s1">!== </span><span class="s7">$job</span><span class="s1">[</span><span class="s8">'cmd'</span><span class="s1">] || </span><span class="s3">false </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$job</span><span class="s1">[</span><span class="s8">'packageName'</span><span class="s1">]</span><span class="s0">, </span><span class="s8">'/'</span><span class="s1">)) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s7">$listed</span><span class="s1">[</span><span class="s7">$job</span><span class="s1">[</span><span class="s8">'packageName'</span><span class="s1">]] = </span><span class="s3">true</span><span class="s0">;</span>
            <span class="s7">$packages</span><span class="s1">[] = [</span><span class="s7">$job</span><span class="s1">[</span><span class="s8">'packageName'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$job</span><span class="s1">[</span><span class="s8">'constraint'</span><span class="s1">]]</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$loadExtraRepos </span><span class="s1">= !(</span><span class="s0">new </span><span class="s1">\</span><span class="s3">ReflectionMethod</span><span class="s1">(</span><span class="s3">Pool</span><span class="s1">::</span><span class="s0">class, </span><span class="s8">'match'</span><span class="s1">))-&gt;</span><span class="s3">isPublic</span><span class="s1">()</span><span class="s0">; </span><span class="s2">// Detect Composer &lt; 1.7.3</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">-&gt;</span><span class="s3">download</span><span class="s1">(</span><span class="s7">$packages</span><span class="s0">, function </span><span class="s1">(</span><span class="s7">$packageName</span><span class="s0">, </span><span class="s7">$constraint</span><span class="s1">) </span><span class="s0">use </span><span class="s1">(&amp;</span><span class="s7">$listed</span><span class="s0">, </span><span class="s1">&amp;</span><span class="s7">$packages</span><span class="s0">, </span><span class="s7">$pool</span><span class="s0">, </span><span class="s7">$loadExtraRepos</span><span class="s1">) {</span>
            <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$pool</span><span class="s1">-&gt;</span><span class="s3">whatProvides</span><span class="s1">(</span><span class="s7">$packageName</span><span class="s0">, </span><span class="s7">$constraint</span><span class="s0">, </span><span class="s3">true</span><span class="s1">) </span><span class="s0">as </span><span class="s7">$package</span><span class="s1">) {</span>
                <span class="s7">$links </span><span class="s1">= </span><span class="s7">$loadExtraRepos </span><span class="s1">? </span><span class="s3">array_merge</span><span class="s1">(</span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getRequires</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getConflicts</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getReplaces</span><span class="s1">()) : </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getRequires</span><span class="s1">()</span><span class="s0">;</span>
                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$links </span><span class="s0">as </span><span class="s7">$link</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$listed</span><span class="s1">[</span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getTarget</span><span class="s1">()]) || </span><span class="s3">false </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getTarget</span><span class="s1">()</span><span class="s0">, </span><span class="s8">'/'</span><span class="s1">)) {</span>
                        <span class="s0">continue;</span>
                    <span class="s1">}</span>
                    <span class="s7">$listed</span><span class="s1">[</span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getTarget</span><span class="s1">()] = </span><span class="s3">true</span><span class="s0">;</span>
                    <span class="s7">$packages</span><span class="s1">[] = [</span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getTarget</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$link</span><span class="s1">-&gt;</span><span class="s3">getConstraint</span><span class="s1">()]</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">populateFilesCacheDir</span><span class="s1">(</span><span class="s3">InstallerEvent </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">|| </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">dryRun</span><span class="s1">) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>
        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">cacheDirPopulated </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>

        <span class="s7">$downloads </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s7">$cacheDir </span><span class="s1">= </span><span class="s3">rtrim</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'cache-files-dir'</span><span class="s1">)</span><span class="s0">, </span><span class="s8">'\/'</span><span class="s1">).\</span><span class="s3">DIRECTORY_SEPARATOR</span><span class="s0">;</span>
        <span class="s7">$getCacheKey </span><span class="s1">= </span><span class="s0">function </span><span class="s1">(</span><span class="s3">PackageInterface </span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$processedUrl</span><span class="s1">) {</span>
            <span class="s0">return </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">getCacheKey</span><span class="s1">(</span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$processedUrl</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span><span class="s0">;</span>
        <span class="s7">$getCacheKey </span><span class="s1">= \</span><span class="s3">Closure</span><span class="s1">::</span><span class="s3">bind</span><span class="s1">(</span><span class="s7">$getCacheKey</span><span class="s0">, new </span><span class="s3">FileDownloader</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s1">)</span><span class="s0">, </span><span class="s3">FileDownloader</span><span class="s1">::</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getOperations</span><span class="s1">() </span><span class="s0">as </span><span class="s7">$op</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s8">'install' </span><span class="s1">=== </span><span class="s7">$op</span><span class="s1">-&gt;</span><span class="s3">getJobType</span><span class="s1">()) {</span>
                <span class="s7">$package </span><span class="s1">= </span><span class="s7">$op</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s8">'update' </span><span class="s1">=== </span><span class="s7">$op</span><span class="s1">-&gt;</span><span class="s3">getJobType</span><span class="s1">()) {</span>
                <span class="s7">$package </span><span class="s1">= </span><span class="s7">$op</span><span class="s1">-&gt;</span><span class="s3">getTargetPackage</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s7">$fileUrl </span><span class="s1">= </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getDistUrl</span><span class="s1">()) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getDistMirrors</span><span class="s1">()) {</span>
                <span class="s7">$fileUrl </span><span class="s1">= </span><span class="s3">current</span><span class="s1">(</span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getDistUrls</span><span class="s1">())</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s3">preg_match</span><span class="s1">(</span><span class="s8">'/^https?:/'</span><span class="s0">, </span><span class="s7">$fileUrl</span><span class="s1">) || !</span><span class="s7">$originUrl </span><span class="s1">= </span><span class="s3">parse_url</span><span class="s1">(</span><span class="s7">$fileUrl</span><span class="s0">, </span><span class="s3">PHP_URL_HOST</span><span class="s1">)) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s7">$file </span><span class="s1">= </span><span class="s7">$cacheDir</span><span class="s1">.</span><span class="s7">$getCacheKey</span><span class="s1">(</span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$fileUrl</span><span class="s1">))) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s1">@</span><span class="s3">mkdir</span><span class="s1">(\</span><span class="s3">dirname</span><span class="s1">(</span><span class="s7">$file</span><span class="s1">)</span><span class="s0">, </span><span class="s9">0775</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s3">is_dir</span><span class="s1">(\</span><span class="s3">dirname</span><span class="s1">(</span><span class="s7">$file</span><span class="s1">))) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s3">preg_match</span><span class="s1">(</span><span class="s8">'#^https://github\.com/#'</span><span class="s0">, </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getSourceUrl</span><span class="s1">()) &amp;&amp; </span><span class="s3">preg_match</span><span class="s1">(</span><span class="s8">'#^https://api\.github\.com/repos(/[^/]++/[^/]++/)zipball(.++)$#'</span><span class="s0">, </span><span class="s7">$fileUrl</span><span class="s0">, </span><span class="s7">$m</span><span class="s1">)) {</span>
                <span class="s7">$fileUrl </span><span class="s1">= </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'https://codeload.github.com%slegacy.zip%s'</span><span class="s0">, </span><span class="s7">$m</span><span class="s1">[</span><span class="s9">1</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$m</span><span class="s1">[</span><span class="s9">2</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s7">$downloads</span><span class="s1">[] = [</span><span class="s7">$originUrl</span><span class="s0">, </span><span class="s7">$fileUrl</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s7">$file</span><span class="s0">, </span><span class="s3">false</span><span class="s1">]</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s9">1 </span><span class="s1">&lt; \</span><span class="s3">count</span><span class="s1">(</span><span class="s7">$downloads</span><span class="s1">)) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">-&gt;</span><span class="s3">download</span><span class="s1">(</span><span class="s7">$downloads</span><span class="s0">, </span><span class="s1">[</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s0">, </span><span class="s8">'get'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">false</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">progress</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">onFileDownload</span><span class="s1">(</span><span class="s3">PreFileDownloadEvent </span><span class="s7">$event</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getRemoteFilesystem</span><span class="s1">() !== </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">) {</span>
            <span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">setRemoteFilesystem</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">-&gt;</span><span class="s3">setNextOptions</span><span class="s1">(</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getRemoteFilesystem</span><span class="s1">()-&gt;</span><span class="s3">getOptions</span><span class="s1">()))</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">generateFlexId</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">getFlexId</span><span class="s1">()) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">isEnabled</span><span class="s1">()) {</span>
            <span class="s0">throw new </span><span class="s1">\</span><span class="s3">LogicException</span><span class="s1">(</span><span class="s8">'Cannot generate project id when &quot;symfony/flex&quot; is not found in the root composer.json.'</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$json </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonFile</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s7">$manipulator </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonManipulator</span><span class="s1">(</span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">()))</span><span class="s0">;</span>
        <span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">addSubNode</span><span class="s1">(</span><span class="s8">'extra'</span><span class="s0">, </span><span class="s8">'symfony.id'</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'/ulid'</span><span class="s1">)-&gt;</span><span class="s3">getBody</span><span class="s1">()[</span><span class="s8">'ulid'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s3">file_put_contents</span><span class="s1">(</span><span class="s7">$json</span><span class="s1">-&gt;</span><span class="s3">getPath</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$manipulator</span><span class="s1">-&gt;</span><span class="s3">getContents</span><span class="s1">())</span><span class="s0">;</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">updateComposerLock</span><span class="s1">()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">updateAutoloadFile</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$platform </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'php'</span><span class="s1">)[</span><span class="s8">'version'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s1">) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$autoloadFile </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s8">'vendor-dir'</span><span class="s1">).</span><span class="s8">'/autoload.php'</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(!</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s7">$autoloadFile</span><span class="s1">)) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$code </span><span class="s1">= </span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$autoloadFile</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$code </span><span class="s1">= </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$code</span><span class="s0">, </span><span class="s1">\</span><span class="s3">strlen</span><span class="s1">(</span><span class="s8">&quot;&lt;?php</span><span class="s0">\n</span><span class="s8">&quot;</span><span class="s1">))</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s3">false </span><span class="s1">!== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$code</span><span class="s0">, </span><span class="s8">'PHP_VERSION_ID'</span><span class="s1">)) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s7">$platform </span><span class="s1">= </span><span class="s3">preg_replace</span><span class="s1">(</span><span class="s8">'/[^-+.~_\w]/'</span><span class="s0">, </span><span class="s8">''</span><span class="s0">, </span><span class="s7">$platform</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$version </span><span class="s1">= </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'%d%02d00'</span><span class="s0">, </span><span class="s1">...</span><span class="s3">explode</span><span class="s1">(</span><span class="s8">'.'</span><span class="s0">, </span><span class="s7">$platform</span><span class="s1">.</span><span class="s8">'.0'</span><span class="s1">))</span><span class="s0">;</span>

        <span class="s3">file_put_contents</span><span class="s1">(</span><span class="s7">$autoloadFile</span><span class="s0">, </span><span class="s3">&lt;&lt;&lt;EOPHP 
</span><span class="s8">&lt;?php 
 
if (\PHP_VERSION_ID &lt; </span><span class="s7">$version</span><span class="s8">) { 
    echo sprintf(&quot;Fatal Error: composer.lock was created for PHP version </span><span class="s7">$platform </span><span class="s8">or higher but the current PHP version is %d.%d.%d.\\n&quot;, PHP_MAJOR_VERSION, PHP_MINOR_VERSION, PHP_RELEASE_VERSION); 
    exit(1); 
} 
</span><span class="s7">$code</span>
<span class="s3">EOPHP</span>
        <span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public function </span><span class="s3">fetchRecipes</span><span class="s1">(</span><span class="s0">array </span><span class="s7">$operations</span><span class="s1">): </span><span class="s0">array</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">isEnabled</span><span class="s1">()) {</span>
            <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s8">'&lt;warning&gt;Symfony recipes are disabled: &quot;symfony/flex&quot; not found in the root composer.json&lt;/&gt;'</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">return </span><span class="s1">[]</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s7">$devPackages </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
        <span class="s7">$data </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">downloader</span><span class="s1">-&gt;</span><span class="s3">getRecipes</span><span class="s1">(</span><span class="s7">$operations</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$manifests </span><span class="s1">= </span><span class="s7">$data</span><span class="s1">[</span><span class="s8">'manifests'</span><span class="s1">] ?? []</span><span class="s0">;</span>
        <span class="s7">$locks </span><span class="s1">= </span><span class="s7">$data</span><span class="s1">[</span><span class="s8">'locks'</span><span class="s1">] ?? []</span><span class="s0">;</span>
        <span class="s2">// symfony/flex and symfony/framework-bundle recipes should always be applied first</span>
        <span class="s7">$recipes </span><span class="s1">= [</span>
            <span class="s8">'symfony/flex' </span><span class="s1">=&gt; </span><span class="s3">null</span><span class="s0">,</span>
            <span class="s8">'symfony/framework-bundle' </span><span class="s1">=&gt; </span><span class="s3">null</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">;</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$operations </span><span class="s0">as </span><span class="s7">$i </span><span class="s1">=&gt; </span><span class="s7">$operation</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UpdateOperation</span><span class="s1">) {</span>
                <span class="s7">$package </span><span class="s1">= </span><span class="s7">$operation</span><span class="s1">-&gt;</span><span class="s3">getTargetPackage</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s7">$package </span><span class="s1">= </span><span class="s7">$operation</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s2">// FIXME: Multi name with getNames()</span>
            <span class="s7">$name </span><span class="s1">= </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getName</span><span class="s1">()</span><span class="s0">;</span>
            <span class="s7">$job </span><span class="s1">= </span><span class="s7">$operation</span><span class="s1">-&gt;</span><span class="s3">getJobType</span><span class="s1">()</span><span class="s0">;</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">][</span><span class="s8">'manifest'</span><span class="s1">][</span><span class="s8">'conflict'</span><span class="s1">]) &amp;&amp; !</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UninstallOperation</span><span class="s1">) {</span>
                <span class="s7">$lockedRepository </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getLocker</span><span class="s1">()-&gt;</span><span class="s3">getLockedRepository</span><span class="s1">()</span><span class="s0">;</span>

                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">][</span><span class="s8">'manifest'</span><span class="s1">][</span><span class="s8">'conflict'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$conflictingPackage </span><span class="s1">=&gt; </span><span class="s7">$constraint</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s7">$lockedRepository</span><span class="s1">-&gt;</span><span class="s3">findPackage</span><span class="s1">(</span><span class="s7">$conflictingPackage</span><span class="s0">, </span><span class="s7">$constraint</span><span class="s1">)) {</span>
                        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">-&gt;</span><span class="s3">writeError</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'  - Skipping recipe for %s: it conflicts with %s %s.'</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$conflictingPackage</span><span class="s0">, </span><span class="s7">$constraint</span><span class="s1">)</span><span class="s0">, </span><span class="s3">true</span><span class="s0">, </span><span class="s3">IOInterface</span><span class="s1">::</span><span class="s3">VERBOSE</span><span class="s1">)</span><span class="s0">;</span>

                        <span class="s0">continue </span><span class="s9">2</span><span class="s0">;</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">InstallOperation </span><span class="s1">&amp;&amp; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$locks</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">])) {</span>
                <span class="s7">$ref </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">get</span><span class="s1">(</span><span class="s7">$name</span><span class="s1">)[</span><span class="s8">'recipe'</span><span class="s1">][</span><span class="s8">'ref'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s7">$ref </span><span class="s1">&amp;&amp; (</span><span class="s7">$locks</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">][</span><span class="s8">'recipe'</span><span class="s1">][</span><span class="s8">'ref'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s1">) === </span><span class="s7">$ref</span><span class="s1">) {</span>
                    <span class="s0">continue;</span>
                <span class="s1">}</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">set</span><span class="s1">(</span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$locks</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UninstallOperation</span><span class="s1">) {</span>
                <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">has</span><span class="s1">(</span><span class="s7">$name</span><span class="s1">)) {</span>
                    <span class="s0">continue;</span>
                <span class="s1">}</span>
                <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">remove</span><span class="s1">(</span><span class="s7">$name</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">])) {</span>
                <span class="s7">$recipes</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">Recipe</span><span class="s1">(</span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$job</span><span class="s0">, </span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$locks</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">] ?? [])</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s7">$noRecipe </span><span class="s1">= !</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">]) || (</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">][</span><span class="s8">'not_installable'</span><span class="s1">]) &amp;&amp; </span><span class="s7">$manifests</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">][</span><span class="s8">'not_installable'</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s7">$noRecipe</span><span class="s1">) {</span>
                <span class="s7">$bundles </span><span class="s1">= []</span><span class="s0">;</span>

                <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$devPackages</span><span class="s1">) {</span>
                    <span class="s7">$devPackages </span><span class="s1">= </span><span class="s3">array_column</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getLocker</span><span class="s1">()-&gt;</span><span class="s3">getLockData</span><span class="s1">()[</span><span class="s8">'packages-dev'</span><span class="s1">]</span><span class="s0">, </span><span class="s8">'name'</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s7">$envs </span><span class="s1">= \</span><span class="s3">in_array</span><span class="s1">(</span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$devPackages</span><span class="s1">) ? [</span><span class="s8">'dev'</span><span class="s0">, </span><span class="s8">'test'</span><span class="s1">] : [</span><span class="s8">'all'</span><span class="s1">]</span><span class="s0">;</span>
                <span class="s7">$bundle </span><span class="s1">= </span><span class="s0">new </span><span class="s3">SymfonyBundle</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s0">, </span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$job</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$bundle</span><span class="s1">-&gt;</span><span class="s3">getClassNames</span><span class="s1">() </span><span class="s0">as </span><span class="s7">$bundleClass</span><span class="s1">) {</span>
                    <span class="s7">$bundles</span><span class="s1">[</span><span class="s7">$bundleClass</span><span class="s1">] = </span><span class="s7">$envs</span><span class="s0">;</span>
                <span class="s1">}</span>

                <span class="s0">if </span><span class="s1">(</span><span class="s7">$bundles</span><span class="s1">) {</span>
                    <span class="s7">$manifest </span><span class="s1">= [</span>
                        <span class="s8">'origin' </span><span class="s1">=&gt; </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'%s:%s@auto-generated recipe'</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getPrettyVersion</span><span class="s1">())</span><span class="s0">,</span>
                        <span class="s8">'manifest' </span><span class="s1">=&gt; [</span><span class="s8">'bundles' </span><span class="s1">=&gt; </span><span class="s7">$bundles</span><span class="s1">]</span><span class="s0">,</span>
                    <span class="s1">]</span><span class="s0">;</span>
                    <span class="s7">$recipes</span><span class="s1">[</span><span class="s7">$name</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">Recipe</span><span class="s1">(</span><span class="s7">$package</span><span class="s0">, </span><span class="s7">$name</span><span class="s0">, </span><span class="s7">$job</span><span class="s0">, </span><span class="s7">$manifest</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s7">$operations </span><span class="s1">= []</span><span class="s0">;</span>

        <span class="s0">return </span><span class="s3">array_filter</span><span class="s1">(</span><span class="s7">$recipes</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">initOptions</span><span class="s1">(): </span><span class="s3">Options</span>
    <span class="s1">{</span>
        <span class="s7">$extra </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getExtra</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s7">$options </span><span class="s1">= </span><span class="s3">array_merge</span><span class="s1">([</span>
            <span class="s8">'bin-dir' </span><span class="s1">=&gt; </span><span class="s8">'bin'</span><span class="s0">,</span>
            <span class="s8">'conf-dir' </span><span class="s1">=&gt; </span><span class="s8">'conf'</span><span class="s0">,</span>
            <span class="s8">'config-dir' </span><span class="s1">=&gt; </span><span class="s8">'config'</span><span class="s0">,</span>
            <span class="s8">'src-dir' </span><span class="s1">=&gt; </span><span class="s8">'src'</span><span class="s0">,</span>
            <span class="s8">'var-dir' </span><span class="s1">=&gt; </span><span class="s8">'var'</span><span class="s0">,</span>
            <span class="s8">'public-dir' </span><span class="s1">=&gt; </span><span class="s8">'public'</span><span class="s0">,</span>
            <span class="s8">'root-dir' </span><span class="s1">=&gt; </span><span class="s7">$extra</span><span class="s1">[</span><span class="s8">'symfony'</span><span class="s1">][</span><span class="s8">'root-dir'</span><span class="s1">] ?? </span><span class="s8">'.'</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">, </span><span class="s7">$extra</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">return new </span><span class="s3">Options</span><span class="s1">(</span><span class="s7">$options</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">getFlexId</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s7">$extra </span><span class="s1">= </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getExtra</span><span class="s1">()</span><span class="s0">;</span>

        <span class="s0">return </span><span class="s7">$extra</span><span class="s1">[</span><span class="s8">'symfony'</span><span class="s1">][</span><span class="s8">'id'</span><span class="s1">] ?? </span><span class="s3">null</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">formatOrigin</span><span class="s1">(</span><span class="s3">string </span><span class="s7">$origin</span><span class="s1">): </span><span class="s3">string</span>
    <span class="s1">{</span>
        <span class="s2">// symfony/translation:3.3@github.com/symfony/recipes:master</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s3">preg_match</span><span class="s1">(</span><span class="s8">'/^([^\:]+?)\:([^\@]+)@(.+)$/'</span><span class="s0">, </span><span class="s7">$origin</span><span class="s0">, </span><span class="s7">$matches</span><span class="s1">)) {</span>
            <span class="s0">return </span><span class="s7">$origin</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s8">'&lt;info&gt;%s&lt;/&gt; (&lt;comment&gt;&gt;=%s&lt;/&gt;): From %s'</span><span class="s0">, </span><span class="s7">$matches</span><span class="s1">[</span><span class="s9">1</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$matches</span><span class="s1">[</span><span class="s9">2</span><span class="s1">]</span><span class="s0">, </span><span class="s8">'auto-generated recipe' </span><span class="s1">=== </span><span class="s7">$matches</span><span class="s1">[</span><span class="s9">3</span><span class="s1">] ? </span><span class="s8">'&lt;comment&gt;'</span><span class="s1">.</span><span class="s7">$matches</span><span class="s1">[</span><span class="s9">3</span><span class="s1">].</span><span class="s8">'&lt;/&gt;' </span><span class="s1">: </span><span class="s7">$matches</span><span class="s1">[</span><span class="s9">3</span><span class="s1">])</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">shouldRecordOperation</span><span class="s1">(</span><span class="s3">PackageEvent </span><span class="s7">$event</span><span class="s1">): </span><span class="s3">bool</span>
    <span class="s1">{</span>
        <span class="s7">$operation </span><span class="s1">= </span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getOperation</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UpdateOperation</span><span class="s1">) {</span>
            <span class="s7">$package </span><span class="s1">= </span><span class="s7">$operation</span><span class="s1">-&gt;</span><span class="s3">getTargetPackage</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s7">$package </span><span class="s1">= </span><span class="s7">$operation</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s2">// when Composer runs with --no-dev, ignore uninstall operations on packages from require-dev</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">isDevMode</span><span class="s1">() &amp;&amp; </span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UninstallOperation</span><span class="s1">) {</span>
            <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$event</span><span class="s1">-&gt;</span><span class="s3">getComposer</span><span class="s1">()-&gt;</span><span class="s3">getLocker</span><span class="s1">()-&gt;</span><span class="s3">getLockData</span><span class="s1">()[</span><span class="s8">'packages-dev'</span><span class="s1">] </span><span class="s0">as </span><span class="s7">$p</span><span class="s1">) {</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getName</span><span class="s1">() === </span><span class="s7">$p</span><span class="s1">[</span><span class="s8">'name'</span><span class="s1">]) {</span>
                    <span class="s0">return </span><span class="s3">false</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s2">// FIXME: Multi name with getNames()</span>
        <span class="s7">$name </span><span class="s1">= </span><span class="s7">$package</span><span class="s1">-&gt;</span><span class="s3">getName</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">InstallOperation</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(!</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">lock</span><span class="s1">-&gt;</span><span class="s3">has</span><span class="s1">(</span><span class="s7">$name</span><span class="s1">)) {</span>
                <span class="s0">return </span><span class="s3">true</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s7">$operation </span><span class="s0">instanceof </span><span class="s3">UninstallOperation</span><span class="s1">) {</span>
            <span class="s0">return </span><span class="s3">true</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s3">false</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">populateRepoCacheDir</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s7">$repos </span><span class="s1">= []</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getPackage</span><span class="s1">()-&gt;</span><span class="s3">getRepositories</span><span class="s1">() </span><span class="s0">as </span><span class="s7">$name </span><span class="s1">=&gt; </span><span class="s7">$repo</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(!</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$repo</span><span class="s1">[</span><span class="s8">'type'</span><span class="s1">]) || </span><span class="s8">'composer' </span><span class="s1">!== </span><span class="s7">$repo</span><span class="s1">[</span><span class="s8">'type'</span><span class="s1">] || !</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$repo</span><span class="s1">[</span><span class="s8">'force-lazy-providers'</span><span class="s1">])) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(!</span><span class="s3">preg_match</span><span class="s1">(</span><span class="s8">'#^http(s\??)?://#'</span><span class="s0">, </span><span class="s7">$repo</span><span class="s1">[</span><span class="s8">'url'</span><span class="s1">])) {</span>
                <span class="s0">continue;</span>
            <span class="s1">}</span>

            <span class="s7">$repo </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ComposerRepository</span><span class="s1">(</span><span class="s7">$repo</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">config</span><span class="s0">, </span><span class="s3">null</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s7">$repos</span><span class="s1">[] = [</span><span class="s7">$repo</span><span class="s1">]</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">rfs</span><span class="s1">-&gt;</span><span class="s3">download</span><span class="s1">(</span><span class="s7">$repos</span><span class="s0">, function </span><span class="s1">(</span><span class="s7">$repo</span><span class="s1">) {</span>
            <span class="s3">ParallelDownloader</span><span class="s1">::</span><span class="s7">$cacheNext </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
            <span class="s7">$repo</span><span class="s1">-&gt;</span><span class="s3">getProviderNames</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">})</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private function </span><span class="s3">updateComposerLock</span><span class="s1">()</span>
    <span class="s1">{</span>
        <span class="s7">$lock </span><span class="s1">= </span><span class="s3">substr</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">()</span><span class="s0">, </span><span class="s9">0</span><span class="s0">, </span><span class="s1">-</span><span class="s9">4</span><span class="s1">).</span><span class="s8">'lock'</span><span class="s0">;</span>
        <span class="s7">$composerJson </span><span class="s1">= </span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s3">Factory</span><span class="s1">::</span><span class="s3">getComposerFile</span><span class="s1">())</span><span class="s0">;</span>
        <span class="s7">$lockFile </span><span class="s1">= </span><span class="s0">new </span><span class="s3">JsonFile</span><span class="s1">(</span><span class="s7">$lock</span><span class="s0">, </span><span class="s3">null</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$locker </span><span class="s1">= </span><span class="s0">new </span><span class="s3">Locker</span><span class="s1">(</span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">io</span><span class="s0">, </span><span class="s7">$lockFile</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getRepositoryManager</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$this</span><span class="s1">-&gt;</span><span class="s3">composer</span><span class="s1">-&gt;</span><span class="s3">getInstallationManager</span><span class="s1">()</span><span class="s0">, </span><span class="s7">$composerJson</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$lockData </span><span class="s1">= </span><span class="s7">$locker</span><span class="s1">-&gt;</span><span class="s3">getLockData</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s7">$lockData</span><span class="s1">[</span><span class="s8">'content-hash'</span><span class="s1">] = </span><span class="s3">Locker</span><span class="s1">::</span><span class="s3">getContentHash</span><span class="s1">(</span><span class="s7">$composerJson</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$lockFile</span><span class="s1">-&gt;</span><span class="s3">write</span><span class="s1">(</span><span class="s7">$lockData</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">getSubscribedEvents</span><span class="s1">(): </span><span class="s0">array</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$activated</span><span class="s1">) {</span>
            <span class="s0">return </span><span class="s1">[]</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s1">[</span>
            <span class="s3">InstallerEvents</span><span class="s1">::</span><span class="s3">PRE_DEPENDENCIES_SOLVING </span><span class="s1">=&gt; [[</span><span class="s8">'populateProvidersCacheDir'</span><span class="s0">, </span><span class="s3">PHP_INT_MAX</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">InstallerEvents</span><span class="s1">::</span><span class="s3">POST_DEPENDENCIES_SOLVING </span><span class="s1">=&gt; [[</span><span class="s8">'populateFilesCacheDir'</span><span class="s0">, </span><span class="s3">PHP_INT_MAX</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s8">'lockPlatform'</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">PackageEvents</span><span class="s1">::</span><span class="s3">PRE_PACKAGE_INSTALL </span><span class="s1">=&gt; [[</span><span class="s8">'populateFilesCacheDir'</span><span class="s0">, </span><span class="s1">~</span><span class="s3">PHP_INT_MAX</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">PackageEvents</span><span class="s1">::</span><span class="s3">PRE_PACKAGE_UPDATE </span><span class="s1">=&gt; [[</span><span class="s8">'populateFilesCacheDir'</span><span class="s0">, </span><span class="s1">~</span><span class="s3">PHP_INT_MAX</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">PackageEvents</span><span class="s1">::</span><span class="s3">POST_PACKAGE_INSTALL </span><span class="s1">=&gt; </span><span class="s3">__CLASS__ </span><span class="s1">=== </span><span class="s3">self</span><span class="s1">::</span><span class="s0">class </span><span class="s1">? [[</span><span class="s8">'record'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s8">'checkForUpdate'</span><span class="s1">]] : </span><span class="s8">'record'</span><span class="s0">,</span>
            <span class="s3">PackageEvents</span><span class="s1">::</span><span class="s3">POST_PACKAGE_UPDATE </span><span class="s1">=&gt; [[</span><span class="s8">'record'</span><span class="s1">]</span><span class="s0">, </span><span class="s1">[</span><span class="s8">'enableThanksReminder'</span><span class="s1">]]</span><span class="s0">,</span>
            <span class="s3">PackageEvents</span><span class="s1">::</span><span class="s3">POST_PACKAGE_UNINSTALL </span><span class="s1">=&gt; </span><span class="s8">'record'</span><span class="s0">,</span>
            <span class="s3">ScriptEvents</span><span class="s1">::</span><span class="s3">POST_CREATE_PROJECT_CMD </span><span class="s1">=&gt; </span><span class="s8">'configureProject'</span><span class="s0">,</span>
            <span class="s3">ScriptEvents</span><span class="s1">::</span><span class="s3">POST_INSTALL_CMD </span><span class="s1">=&gt; </span><span class="s8">'install'</span><span class="s0">,</span>
            <span class="s3">ScriptEvents</span><span class="s1">::</span><span class="s3">PRE_UPDATE_CMD </span><span class="s1">=&gt; </span><span class="s8">'configureInstaller'</span><span class="s0">,</span>
            <span class="s3">ScriptEvents</span><span class="s1">::</span><span class="s3">POST_UPDATE_CMD </span><span class="s1">=&gt; </span><span class="s8">'update'</span><span class="s0">,</span>
            <span class="s3">ScriptEvents</span><span class="s1">::</span><span class="s3">POST_AUTOLOAD_DUMP </span><span class="s1">=&gt; </span><span class="s8">'updateAutoloadFile'</span><span class="s0">,</span>
            <span class="s3">PluginEvents</span><span class="s1">::</span><span class="s3">PRE_FILE_DOWNLOAD </span><span class="s1">=&gt; </span><span class="s8">'onFileDownload'</span><span class="s0">,</span>
            <span class="s8">'auto-scripts' </span><span class="s1">=&gt; </span><span class="s8">'executeAutoScripts'</span><span class="s0">,</span>
        <span class="s1">]</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>
</pre>
</body>
</html>