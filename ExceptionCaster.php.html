<html>
<head>
<title>ExceptionCaster.php</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #a9b7c6;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #629755; font-weight: bold; font-style: italic;}
.s6 { color: #77b767; font-style: italic;}
.s7 { color: #9876aa;}
.s8 { color: #6897bb;}
.s9 { color: #6a8759;}
.ls0 { height: 1px; border-width: 0; color: #4d4d4d; background-color:#4d4d4d}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ExceptionCaster.php</font>
</center></td></tr></table>
<pre><span class="s0">&lt;?php</span>

<span class="s2">/* 
 * This file is part of the Symfony package. 
 * 
 * (c) Fabien Potencier &lt;fabien@symfony.com&gt; 
 * 
 * For the full copyright and license information, please view the LICENSE 
 * file that was distributed with this source code. 
 */</span>
<hr class="ls0"><span class="s0">namespace </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Component</span><span class="s1">\</span><span class="s3">VarDumper</span><span class="s1">\</span><span class="s3">Caster</span><span class="s0">;</span>

<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Component</span><span class="s1">\</span><span class="s3">ErrorHandler</span><span class="s1">\</span><span class="s3">Exception</span><span class="s1">\</span><span class="s3">SilencedErrorContext</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Component</span><span class="s1">\</span><span class="s3">VarDumper</span><span class="s1">\</span><span class="s3">Cloner</span><span class="s1">\</span><span class="s3">Stub</span><span class="s0">;</span>
<span class="s0">use </span><span class="s3">Symfony</span><span class="s1">\</span><span class="s3">Component</span><span class="s1">\</span><span class="s3">VarDumper</span><span class="s1">\</span><span class="s3">Exception</span><span class="s1">\</span><span class="s3">ThrowingCasterException</span><span class="s0">;</span>
<hr class="ls0"><span class="s4">/**</span>
 <span class="s4">* Casts common Exception classes to array representation.</span>
 <span class="s4">*</span>
 <span class="s4">* </span><span class="s5">@author </span><span class="s4">Nicolas Grekas </span><span class="s6">&lt;p</span><span class="s4">@tchwork.com&gt;</span>
 <span class="s4">*</span>
 <span class="s4">* </span><span class="s5">@final</span>
 <span class="s4">*/</span>
<span class="s0">class </span><span class="s3">ExceptionCaster</span>
<span class="s1">{</span>
    <span class="s0">public static </span><span class="s7">$srcContext </span><span class="s1">= </span><span class="s8">1</span><span class="s0">;</span>
    <span class="s0">public static </span><span class="s7">$traceArgs </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
    <span class="s0">public static </span><span class="s7">$errorTypes </span><span class="s1">= [</span>
        <span class="s3">E_DEPRECATED </span><span class="s1">=&gt; </span><span class="s9">'E_DEPRECATED'</span><span class="s0">,</span>
        <span class="s3">E_USER_DEPRECATED </span><span class="s1">=&gt; </span><span class="s9">'E_USER_DEPRECATED'</span><span class="s0">,</span>
        <span class="s3">E_RECOVERABLE_ERROR </span><span class="s1">=&gt; </span><span class="s9">'E_RECOVERABLE_ERROR'</span><span class="s0">,</span>
        <span class="s3">E_ERROR </span><span class="s1">=&gt; </span><span class="s9">'E_ERROR'</span><span class="s0">,</span>
        <span class="s3">E_WARNING </span><span class="s1">=&gt; </span><span class="s9">'E_WARNING'</span><span class="s0">,</span>
        <span class="s3">E_PARSE </span><span class="s1">=&gt; </span><span class="s9">'E_PARSE'</span><span class="s0">,</span>
        <span class="s3">E_NOTICE </span><span class="s1">=&gt; </span><span class="s9">'E_NOTICE'</span><span class="s0">,</span>
        <span class="s3">E_CORE_ERROR </span><span class="s1">=&gt; </span><span class="s9">'E_CORE_ERROR'</span><span class="s0">,</span>
        <span class="s3">E_CORE_WARNING </span><span class="s1">=&gt; </span><span class="s9">'E_CORE_WARNING'</span><span class="s0">,</span>
        <span class="s3">E_COMPILE_ERROR </span><span class="s1">=&gt; </span><span class="s9">'E_COMPILE_ERROR'</span><span class="s0">,</span>
        <span class="s3">E_COMPILE_WARNING </span><span class="s1">=&gt; </span><span class="s9">'E_COMPILE_WARNING'</span><span class="s0">,</span>
        <span class="s3">E_USER_ERROR </span><span class="s1">=&gt; </span><span class="s9">'E_USER_ERROR'</span><span class="s0">,</span>
        <span class="s3">E_USER_WARNING </span><span class="s1">=&gt; </span><span class="s9">'E_USER_WARNING'</span><span class="s0">,</span>
        <span class="s3">E_USER_NOTICE </span><span class="s1">=&gt; </span><span class="s9">'E_USER_NOTICE'</span><span class="s0">,</span>
        <span class="s3">E_STRICT </span><span class="s1">=&gt; </span><span class="s9">'E_STRICT'</span><span class="s0">,</span>
    <span class="s1">]</span><span class="s0">;</span>

    <span class="s0">private static </span><span class="s7">$framesCache </span><span class="s1">= []</span><span class="s0">;</span>

    <span class="s0">public static function </span><span class="s3">castError</span><span class="s1">(\</span><span class="s3">Error </span><span class="s7">$e</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$filter </span><span class="s1">= </span><span class="s8">0</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">return </span><span class="s3">self</span><span class="s1">::</span><span class="s3">filterExceptionArray</span><span class="s1">(</span><span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class</span><span class="s0">, </span><span class="s7">$a</span><span class="s0">, </span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">Error</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s0">, </span><span class="s7">$filter</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castException</span><span class="s1">(\</span><span class="s3">Exception </span><span class="s7">$e</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$filter </span><span class="s1">= </span><span class="s8">0</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">return </span><span class="s3">self</span><span class="s1">::</span><span class="s3">filterExceptionArray</span><span class="s1">(</span><span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class</span><span class="s0">, </span><span class="s7">$a</span><span class="s0">, </span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">Exception</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s0">, </span><span class="s7">$filter</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castErrorException</span><span class="s1">(\</span><span class="s3">ErrorException </span><span class="s7">$e</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s </span><span class="s1">= </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'severity'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$errorTypes</span><span class="s1">[</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">]])) {</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">ConstStub</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$errorTypes</span><span class="s1">[</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">]]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castThrowingCasterException</span><span class="s1">(</span><span class="s3">ThrowingCasterException </span><span class="s7">$e</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s7">$trace </span><span class="s1">= </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_VIRTUAL</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s0">;</span>
        <span class="s7">$prefix </span><span class="s1">= </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s0">;</span>
        <span class="s7">$xPrefix </span><span class="s1">= </span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">Exception</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$trace</span><span class="s1">]) &amp;&amp; </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">] </span><span class="s0">instanceof </span><span class="s1">\</span><span class="s3">Exception</span><span class="s1">) {</span>
            <span class="s7">$b </span><span class="s1">= (array) </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s7">$class </span><span class="s1">= \</span><span class="s3">get_class</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s7">$class </span><span class="s1">= </span><span class="s9">'c' </span><span class="s1">=== </span><span class="s7">$class</span><span class="s1">[</span><span class="s8">0</span><span class="s1">] &amp;&amp; </span><span class="s8">0 </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$class</span><span class="s0">, </span><span class="s9">&quot;class@anonymous</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s1">) ? </span><span class="s3">get_parent_class</span><span class="s1">(</span><span class="s7">$class</span><span class="s1">).</span><span class="s9">'@anonymous' </span><span class="s1">: </span><span class="s7">$class</span><span class="s0">;</span>
            <span class="s3">self</span><span class="s1">::</span><span class="s3">traceUnshift</span><span class="s1">(</span><span class="s7">$b</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$class</span><span class="s0">, </span><span class="s7">$b</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$b</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s7">$trace</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">TraceStub</span><span class="s1">(</span><span class="s7">$b</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">false</span><span class="s0">, </span><span class="s8">0</span><span class="s0">, </span><span class="s1">-\</span><span class="s3">count</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$trace</span><span class="s1">]-&gt;</span><span class="s3">value</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'code'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castSilencedErrorContext</span><span class="s1">(</span><span class="s3">SilencedErrorContext </span><span class="s7">$e</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s7">$sPrefix </span><span class="s1">= </span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s1">.</span><span class="s3">SilencedErrorContext</span><span class="s1">::</span><span class="s0">class</span><span class="s1">.</span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(!</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s </span><span class="s1">= </span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'severity'</span><span class="s1">])) {</span>
            <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$errorTypes</span><span class="s1">[</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">]])) {</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">ConstStub</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$errorTypes</span><span class="s1">[</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">]]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$s</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$trace </span><span class="s1">= [[</span>
            <span class="s9">'file' </span><span class="s1">=&gt; </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">,</span>
            <span class="s9">'line' </span><span class="s1">=&gt; </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">,</span>
        <span class="s1">]]</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">])) {</span>
            <span class="s7">$trace </span><span class="s1">= </span><span class="s3">array_merge</span><span class="s1">(</span><span class="s7">$trace</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$sPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_VIRTUAL</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">TraceStub</span><span class="s1">(</span><span class="s7">$trace</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$traceArgs</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castTraceStub</span><span class="s1">(</span><span class="s3">TraceStub </span><span class="s7">$trace</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$isNested</span><span class="s1">) {</span>
            <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class </span><span class="s1">= </span><span class="s9">''</span><span class="s0">;</span>
        <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">handle </span><span class="s1">= </span><span class="s8">0</span><span class="s0">;</span>
        <span class="s7">$frames </span><span class="s1">= </span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s0">;</span>
        <span class="s7">$prefix </span><span class="s1">= </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_VIRTUAL</span><span class="s0">;</span>

        <span class="s7">$a </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s7">$j </span><span class="s1">= \</span><span class="s3">count</span><span class="s1">(</span><span class="s7">$frames</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s8">0 </span><span class="s1">&gt; </span><span class="s7">$i </span><span class="s1">= </span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">sliceOffset</span><span class="s1">) {</span>
            <span class="s7">$i </span><span class="s1">= </span><span class="s3">max</span><span class="s1">(</span><span class="s8">0</span><span class="s0">, </span><span class="s7">$j </span><span class="s1">+ </span><span class="s7">$i</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">])) {</span>
            <span class="s0">return </span><span class="s1">[]</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s7">$lastCall </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s9">'function'</span><span class="s1">]) ? (</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s7">$frames</span><span class="s1">[</span><span class="s8">0</span><span class="s1">][</span><span class="s9">'class'</span><span class="s1">].</span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s9">'type'</span><span class="s1">] : </span><span class="s9">''</span><span class="s1">).</span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s9">'function'</span><span class="s1">].</span><span class="s9">'()' </span><span class="s1">: </span><span class="s9">''</span><span class="s0">;</span>
        <span class="s7">$frames</span><span class="s1">[] = [</span><span class="s9">'function' </span><span class="s1">=&gt; </span><span class="s9">''</span><span class="s1">]</span><span class="s0">;</span>
        <span class="s7">$collapse </span><span class="s1">= </span><span class="s3">false</span><span class="s0">;</span>

        <span class="s0">for </span><span class="s1">(</span><span class="s7">$j </span><span class="s1">+= </span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">numberingOffset </span><span class="s1">- </span><span class="s7">$i</span><span class="s1">++</span><span class="s0">; isset</span><span class="s1">(</span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">])</span><span class="s0">; </span><span class="s1">++</span><span class="s7">$i</span><span class="s0">, </span><span class="s1">--</span><span class="s7">$j</span><span class="s1">) {</span>
            <span class="s7">$f </span><span class="s1">= </span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s7">$call </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]) ? (</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">].</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'type'</span><span class="s1">] : </span><span class="s9">''</span><span class="s1">).</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">] : </span><span class="s9">'???'</span><span class="s0">;</span>

            <span class="s7">$frame </span><span class="s1">= </span><span class="s0">new </span><span class="s3">FrameStub</span><span class="s1">(</span>
                <span class="s1">[</span>
                    <span class="s9">'object' </span><span class="s1">=&gt; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'object'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'object'</span><span class="s1">] : </span><span class="s3">null</span><span class="s0">,</span>
                    <span class="s9">'class' </span><span class="s1">=&gt; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">] : </span><span class="s3">null</span><span class="s0">,</span>
                    <span class="s9">'type' </span><span class="s1">=&gt; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'type'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'type'</span><span class="s1">] : </span><span class="s3">null</span><span class="s0">,</span>
                    <span class="s9">'function' </span><span class="s1">=&gt; </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">] : </span><span class="s3">null</span><span class="s0">,</span>
                <span class="s1">] + </span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i </span><span class="s1">- </span><span class="s8">1</span><span class="s1">]</span><span class="s0">,</span>
                <span class="s3">false</span><span class="s0">,</span>
                <span class="s3">true</span>
            <span class="s1">)</span><span class="s0">;</span>
            <span class="s7">$f </span><span class="s1">= </span><span class="s3">self</span><span class="s1">::</span><span class="s3">castFrameStub</span><span class="s1">(</span><span class="s7">$frame</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s7">$frame</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'src'</span><span class="s1">])) {</span>
                <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'src'</span><span class="s1">]-&gt;</span><span class="s3">value </span><span class="s0">as </span><span class="s7">$label </span><span class="s1">=&gt; </span><span class="s7">$frame</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s8">0 </span><span class="s1">=== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$label</span><span class="s0">, </span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">~collapse=0&quot;</span><span class="s1">)) {</span>
                        <span class="s0">if </span><span class="s1">(</span><span class="s7">$collapse</span><span class="s1">) {</span>
                            <span class="s7">$label </span><span class="s1">= </span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$label</span><span class="s0">, </span><span class="s9">'1'</span><span class="s0">, </span><span class="s8">11</span><span class="s0">, </span><span class="s8">1</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                            <span class="s7">$collapse </span><span class="s1">= </span><span class="s3">true</span><span class="s0">;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                    <span class="s7">$label </span><span class="s1">= </span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$label</span><span class="s0">, </span><span class="s9">&quot;title=Stack level </span><span class="s7">$j</span><span class="s9">.&amp;&quot;</span><span class="s0">, </span><span class="s8">2</span><span class="s0">, </span><span class="s8">0</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s7">$f </span><span class="s1">= </span><span class="s7">$frames</span><span class="s1">[</span><span class="s7">$i </span><span class="s1">- </span><span class="s8">1</span><span class="s1">]</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">keepArgs </span><span class="s1">&amp;&amp; !</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'args'</span><span class="s1">]) &amp;&amp; </span><span class="s7">$frame </span><span class="s0">instanceof </span><span class="s3">EnumStub</span><span class="s1">) {</span>
                    <span class="s7">$frame</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s1">[</span><span class="s9">'arguments'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">ArgsStub</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'args'</span><span class="s1">]</span><span class="s0">, isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">] : </span><span class="s3">null</span><span class="s0">, isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">] : </span><span class="s3">null</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s0">elseif </span><span class="s1">(</span><span class="s9">'???' </span><span class="s1">!== </span><span class="s7">$lastCall</span><span class="s1">) {</span>
                <span class="s7">$label </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ClassStub</span><span class="s1">(</span><span class="s7">$lastCall</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$label</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis'</span><span class="s1">])) {</span>
                    <span class="s7">$label</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis'</span><span class="s1">] += </span><span class="s8">2</span><span class="s0">;</span>
                    <span class="s7">$label </span><span class="s1">= </span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$prefix</span><span class="s0">, </span><span class="s9">&quot;ellipsis-type=class&amp;ellipsis=</span><span class="s1">{</span><span class="s7">$label</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis'</span><span class="s1">]}</span><span class="s9">&amp;ellipsis-tail=1&amp;title=Stack level </span><span class="s7">$j</span><span class="s9">.&quot;</span><span class="s0">, </span><span class="s8">2</span><span class="s0">, </span><span class="s8">0</span><span class="s1">).</span><span class="s7">$label</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s1">.</span><span class="s9">'()'</span><span class="s0">;</span>
                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s7">$label </span><span class="s1">= </span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$prefix</span><span class="s0">, </span><span class="s9">&quot;title=Stack level </span><span class="s7">$j</span><span class="s9">.&quot;</span><span class="s0">, </span><span class="s8">2</span><span class="s0">, </span><span class="s8">0</span><span class="s1">).</span><span class="s7">$label</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s1">.</span><span class="s9">'()'</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s7">$label </span><span class="s1">= </span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$prefix</span><span class="s0">, </span><span class="s9">&quot;title=Stack level </span><span class="s7">$j</span><span class="s9">.&quot;</span><span class="s0">, </span><span class="s8">2</span><span class="s0">, </span><span class="s8">0</span><span class="s1">).</span><span class="s7">$lastCall</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s3">substr_replace</span><span class="s1">(</span><span class="s7">$label</span><span class="s0">, </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s9">'separator=%s&amp;'</span><span class="s0">, </span><span class="s7">$frame </span><span class="s0">instanceof </span><span class="s3">EnumStub </span><span class="s1">? </span><span class="s9">' ' </span><span class="s1">: </span><span class="s9">':'</span><span class="s1">)</span><span class="s0">, </span><span class="s8">2</span><span class="s0">, </span><span class="s8">0</span><span class="s1">)] = </span><span class="s7">$frame</span><span class="s0">;</span>

            <span class="s7">$lastCall </span><span class="s1">= </span><span class="s7">$call</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">!== </span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">sliceLength</span><span class="s1">) {</span>
            <span class="s7">$a </span><span class="s1">= \</span><span class="s3">array_slice</span><span class="s1">(</span><span class="s7">$a</span><span class="s0">, </span><span class="s8">0</span><span class="s0">, </span><span class="s7">$trace</span><span class="s1">-&gt;</span><span class="s3">sliceLength</span><span class="s0">, </span><span class="s3">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public static function </span><span class="s3">castFrameStub</span><span class="s1">(</span><span class="s3">FrameStub </span><span class="s7">$frame</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">Stub </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">bool </span><span class="s7">$isNested</span><span class="s1">)</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(!</span><span class="s7">$isNested</span><span class="s1">) {</span>
            <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s7">$f </span><span class="s1">= </span><span class="s7">$frame</span><span class="s1">-&gt;</span><span class="s3">value</span><span class="s0">;</span>
        <span class="s7">$prefix </span><span class="s1">= </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_VIRTUAL</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">])) {</span>
            <span class="s7">$cacheKey </span><span class="s1">= </span><span class="s7">$f</span><span class="s0">;</span>
            <span class="s0">unset</span><span class="s1">(</span><span class="s7">$cacheKey</span><span class="s1">[</span><span class="s9">'object'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$cacheKey</span><span class="s1">[</span><span class="s9">'args'</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s7">$cacheKey</span><span class="s1">[] = </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$srcContext</span><span class="s0">;</span>
            <span class="s7">$cacheKey </span><span class="s1">= </span><span class="s3">implode</span><span class="s1">(</span><span class="s9">'-'</span><span class="s0">, </span><span class="s7">$cacheKey</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s3">self</span><span class="s1">::</span><span class="s7">$framesCache</span><span class="s1">[</span><span class="s7">$cacheKey</span><span class="s1">])) {</span>
                <span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'src'</span><span class="s1">] = </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$framesCache</span><span class="s1">[</span><span class="s7">$cacheKey</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s3">preg_match</span><span class="s1">(</span><span class="s9">'/\((\d+)\)(?:\([\da-f]{32}\))? : (?:eval\(\)</span><span class="s0">\'</span><span class="s9">d code|runtime-created function)$/'</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$match</span><span class="s1">)) {</span>
                    <span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">] = </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s8">0</span><span class="s0">, </span><span class="s1">-\</span><span class="s3">strlen</span><span class="s1">(</span><span class="s7">$match</span><span class="s1">[</span><span class="s8">0</span><span class="s1">]))</span><span class="s0">;</span>
                    <span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">] = (int) </span><span class="s7">$match</span><span class="s1">[</span><span class="s8">1</span><span class="s1">]</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s7">$src </span><span class="s1">= </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">;</span>
                <span class="s7">$srcKey </span><span class="s1">= </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">;</span>
                <span class="s7">$ellipsis </span><span class="s1">= </span><span class="s0">new </span><span class="s3">LinkStub</span><span class="s1">(</span><span class="s7">$srcKey</span><span class="s0">, </span><span class="s8">0</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s7">$srcAttr </span><span class="s1">= </span><span class="s9">'collapse='</span><span class="s1">.(int) </span><span class="s7">$ellipsis</span><span class="s1">-&gt;</span><span class="s3">inVendor</span><span class="s0">;</span>
                <span class="s7">$ellipsisTail </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$ellipsis</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis-tail'</span><span class="s1">]) ? </span><span class="s7">$ellipsis</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis-tail'</span><span class="s1">] : </span><span class="s8">0</span><span class="s0">;</span>
                <span class="s7">$ellipsis </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$ellipsis</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis'</span><span class="s1">]) ? </span><span class="s7">$ellipsis</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'ellipsis'</span><span class="s1">] : </span><span class="s8">0</span><span class="s0">;</span>

                <span class="s0">if </span><span class="s1">(</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]) &amp;&amp; </span><span class="s8">0 </span><span class="s1">&lt;= </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$srcContext</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(!</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) &amp;&amp; (</span><span class="s3">is_subclass_of</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]</span><span class="s0">, </span><span class="s9">'Twig\Template'</span><span class="s1">) || </span><span class="s3">is_subclass_of</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]</span><span class="s0">, </span><span class="s9">'Twig_Template'</span><span class="s1">)) &amp;&amp; </span><span class="s3">method_exists</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]</span><span class="s0">, </span><span class="s9">'getDebugInfo'</span><span class="s1">)) {</span>
                        <span class="s7">$template </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'object'</span><span class="s1">]) ? </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'object'</span><span class="s1">] : </span><span class="s3">unserialize</span><span class="s1">(</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s9">'O:%d:&quot;%s&quot;:0:{}'</span><span class="s0">, </span><span class="s1">\</span><span class="s3">strlen</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">])</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]))</span><span class="s0">;</span>

                        <span class="s7">$ellipsis </span><span class="s1">= </span><span class="s8">0</span><span class="s0">;</span>
                        <span class="s7">$templateSrc </span><span class="s1">= </span><span class="s3">method_exists</span><span class="s1">(</span><span class="s7">$template</span><span class="s0">, </span><span class="s9">'getSourceContext'</span><span class="s1">) ? </span><span class="s7">$template</span><span class="s1">-&gt;</span><span class="s3">getSourceContext</span><span class="s1">()-&gt;</span><span class="s3">getCode</span><span class="s1">() : (</span><span class="s3">method_exists</span><span class="s1">(</span><span class="s7">$template</span><span class="s0">, </span><span class="s9">'getSource'</span><span class="s1">) ? </span><span class="s7">$template</span><span class="s1">-&gt;</span><span class="s3">getSource</span><span class="s1">() : </span><span class="s9">''</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s7">$templateInfo </span><span class="s1">= </span><span class="s7">$template</span><span class="s1">-&gt;</span><span class="s3">getDebugInfo</span><span class="s1">()</span><span class="s0">;</span>
                        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$templateInfo</span><span class="s1">[</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]])) {</span>
                            <span class="s0">if </span><span class="s1">(!</span><span class="s3">method_exists</span><span class="s1">(</span><span class="s7">$template</span><span class="s0">, </span><span class="s9">'getSourceContext'</span><span class="s1">) || !</span><span class="s3">file_exists</span><span class="s1">(</span><span class="s7">$templatePath </span><span class="s1">= </span><span class="s7">$template</span><span class="s1">-&gt;</span><span class="s3">getSourceContext</span><span class="s1">()-&gt;</span><span class="s3">getPath</span><span class="s1">())) {</span>
                                <span class="s7">$templatePath </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
                            <span class="s1">}</span>
                            <span class="s0">if </span><span class="s1">(</span><span class="s7">$templateSrc</span><span class="s1">) {</span>
                                <span class="s7">$src </span><span class="s1">= </span><span class="s3">self</span><span class="s1">::</span><span class="s3">extractSource</span><span class="s1">(</span><span class="s7">$templateSrc</span><span class="s0">, </span><span class="s7">$templateInfo</span><span class="s1">[</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]]</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$srcContext</span><span class="s0">, </span><span class="s9">'twig'</span><span class="s0">, </span><span class="s7">$templatePath</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">)</span><span class="s0">;</span>
                                <span class="s7">$srcKey </span><span class="s1">= (</span><span class="s7">$templatePath </span><span class="s1">?: </span><span class="s7">$template</span><span class="s1">-&gt;</span><span class="s3">getTemplateName</span><span class="s1">()).</span><span class="s9">':'</span><span class="s1">.</span><span class="s7">$templateInfo</span><span class="s1">[</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]]</span><span class="s0">;</span>
                            <span class="s1">}</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s7">$srcKey </span><span class="s1">== </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]) {</span>
                        <span class="s7">$src </span><span class="s1">= </span><span class="s3">self</span><span class="s1">::</span><span class="s3">extractSource</span><span class="s1">(</span><span class="s3">file_get_contents</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">])</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$srcContext</span><span class="s0">, </span><span class="s9">'php'</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s7">$srcKey </span><span class="s1">.= </span><span class="s9">':'</span><span class="s1">.</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">;</span>
                        <span class="s0">if </span><span class="s1">(</span><span class="s7">$ellipsis</span><span class="s1">) {</span>
                            <span class="s7">$ellipsis </span><span class="s1">+= </span><span class="s8">1 </span><span class="s1">+ \</span><span class="s3">strlen</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>
                        <span class="s1">}</span>
                    <span class="s1">}</span>
                    <span class="s7">$srcAttr </span><span class="s1">.= </span><span class="s3">sprintf</span><span class="s1">(</span><span class="s9">'&amp;separator= &amp;file=%s&amp;line=%d'</span><span class="s0">, </span><span class="s3">rawurlencode</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">])</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>
                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s7">$srcAttr </span><span class="s1">.= </span><span class="s9">'&amp;separator=:'</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s7">$srcAttr </span><span class="s1">.= </span><span class="s7">$ellipsis </span><span class="s1">? </span><span class="s9">'&amp;ellipsis-type=path&amp;ellipsis='</span><span class="s1">.</span><span class="s7">$ellipsis</span><span class="s1">.</span><span class="s9">'&amp;ellipsis-tail='</span><span class="s1">.</span><span class="s7">$ellipsisTail </span><span class="s1">: </span><span class="s9">''</span><span class="s0">;</span>
                <span class="s3">self</span><span class="s1">::</span><span class="s7">$framesCache</span><span class="s1">[</span><span class="s7">$cacheKey</span><span class="s1">] = </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'src'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">EnumStub</span><span class="s1">([</span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">~</span><span class="s7">$srcAttr</span><span class="s0">\0</span><span class="s7">$srcKey</span><span class="s9">&quot; </span><span class="s1">=&gt; </span><span class="s7">$src</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'args'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">-&gt;</span><span class="s3">inTraceStub</span><span class="s1">) {</span>
            <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'class'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'type'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'function'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$a </span><span class="s0">as </span><span class="s7">$k </span><span class="s1">=&gt; </span><span class="s7">$v</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(!</span><span class="s7">$v</span><span class="s1">) {</span>
                <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$k</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">-&gt;</span><span class="s3">keepArgs </span><span class="s1">&amp;&amp; !</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'args'</span><span class="s1">])) {</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s7">$prefix</span><span class="s1">.</span><span class="s9">'arguments'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">ArgsStub</span><span class="s1">(</span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'args'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$f</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private static function </span><span class="s3">filterExceptionArray</span><span class="s1">(</span><span class="s3">string </span><span class="s7">$xClass</span><span class="s0">, array </span><span class="s7">$a</span><span class="s0">, </span><span class="s3">string </span><span class="s7">$xPrefix</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$filter</span><span class="s1">): </span><span class="s0">array</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">])) {</span>
            <span class="s7">$trace </span><span class="s1">= </span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">])</span><span class="s0">; </span><span class="s2">// Ensures the trace is always last</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s7">$trace </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(!(</span><span class="s7">$filter </span><span class="s1">&amp; </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">EXCLUDE_VERBOSE</span><span class="s1">) &amp;&amp; </span><span class="s7">$trace</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])) {</span>
                <span class="s3">self</span><span class="s1">::</span><span class="s3">traceUnshift</span><span class="s1">(</span><span class="s7">$trace</span><span class="s0">, </span><span class="s7">$xClass</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_VIRTUAL</span><span class="s1">.</span><span class="s9">'trace'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">TraceStub</span><span class="s1">(</span><span class="s7">$trace</span><span class="s0">, </span><span class="s3">self</span><span class="s1">::</span><span class="s7">$traceArgs</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s0">empty</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">])) {</span>
            <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'previous'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">unset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s7">$xPrefix</span><span class="s1">.</span><span class="s9">'string'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_DYNAMIC</span><span class="s1">.</span><span class="s9">'xdebug_message'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_DYNAMIC</span><span class="s1">.</span><span class="s9">'__destructorException'</span><span class="s1">])</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'message'</span><span class="s1">]) &amp;&amp; </span><span class="s3">false </span><span class="s1">!== </span><span class="s3">strpos</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'message'</span><span class="s1">]</span><span class="s0">, </span><span class="s9">&quot;class@anonymous</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s1">)) {</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'message'</span><span class="s1">] = </span><span class="s3">preg_replace_callback</span><span class="s1">(</span><span class="s9">'/class@anonymous\x00.*?\.php(?:0x?|:[0-9]++\$)[0-9a-fA-F]++/'</span><span class="s0">, function </span><span class="s1">(</span><span class="s7">$m</span><span class="s1">) {</span>
                <span class="s0">return </span><span class="s3">class_exists</span><span class="s1">(</span><span class="s7">$m</span><span class="s1">[</span><span class="s8">0</span><span class="s1">]</span><span class="s0">, </span><span class="s3">false</span><span class="s1">) ? </span><span class="s3">get_parent_class</span><span class="s1">(</span><span class="s7">$m</span><span class="s1">[</span><span class="s8">0</span><span class="s1">]).</span><span class="s9">'@anonymous' </span><span class="s1">: </span><span class="s7">$m</span><span class="s1">[</span><span class="s8">0</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s1">}</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'message'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])) {</span>
            <span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">] = </span><span class="s0">new </span><span class="s3">LinkStub</span><span class="s1">(</span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$a</span><span class="s1">[</span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">PREFIX_PROTECTED</span><span class="s1">.</span><span class="s9">'line'</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return </span><span class="s7">$a</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private static function </span><span class="s3">traceUnshift</span><span class="s1">(</span><span class="s0">array </span><span class="s1">&amp;</span><span class="s7">$trace</span><span class="s0">, </span><span class="s1">?</span><span class="s3">string </span><span class="s7">$class</span><span class="s0">, </span><span class="s3">string </span><span class="s7">$file</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$line</span><span class="s1">): </span><span class="s3">void</span>
    <span class="s1">{</span>
        <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">0</span><span class="s1">][</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">0</span><span class="s1">][</span><span class="s9">'line'</span><span class="s1">]) &amp;&amp; </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">0</span><span class="s1">][</span><span class="s9">'file'</span><span class="s1">] === </span><span class="s7">$file </span><span class="s1">&amp;&amp; </span><span class="s7">$trace</span><span class="s1">[</span><span class="s8">0</span><span class="s1">][</span><span class="s9">'line'</span><span class="s1">] === </span><span class="s7">$line</span><span class="s1">) {</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>
        <span class="s3">array_unshift</span><span class="s1">(</span><span class="s7">$trace</span><span class="s0">, </span><span class="s1">[</span>
            <span class="s9">'function' </span><span class="s1">=&gt; </span><span class="s7">$class </span><span class="s1">? </span><span class="s9">'new '</span><span class="s1">.</span><span class="s7">$class </span><span class="s1">: </span><span class="s3">null</span><span class="s0">,</span>
            <span class="s9">'file' </span><span class="s1">=&gt; </span><span class="s7">$file</span><span class="s0">,</span>
            <span class="s9">'line' </span><span class="s1">=&gt; </span><span class="s7">$line</span><span class="s0">,</span>
        <span class="s1">])</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private static function </span><span class="s3">extractSource</span><span class="s1">(</span><span class="s3">string </span><span class="s7">$srcLines</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$line</span><span class="s0">, </span><span class="s3">int </span><span class="s7">$srcContext</span><span class="s0">, </span><span class="s3">string </span><span class="s7">$lang</span><span class="s0">, </span><span class="s1">?</span><span class="s3">string </span><span class="s7">$file</span><span class="s0">, array </span><span class="s7">$frame</span><span class="s1">): </span><span class="s3">EnumStub</span>
    <span class="s1">{</span>
        <span class="s7">$srcLines </span><span class="s1">= </span><span class="s3">explode</span><span class="s1">(</span><span class="s9">&quot;</span><span class="s0">\n</span><span class="s9">&quot;</span><span class="s0">, </span><span class="s7">$srcLines</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s7">$src </span><span class="s1">= []</span><span class="s0">;</span>

        <span class="s0">for </span><span class="s1">(</span><span class="s7">$i </span><span class="s1">= </span><span class="s7">$line </span><span class="s1">- </span><span class="s8">1 </span><span class="s1">- </span><span class="s7">$srcContext</span><span class="s0">; </span><span class="s7">$i </span><span class="s1">&lt;= </span><span class="s7">$line </span><span class="s1">- </span><span class="s8">1 </span><span class="s1">+ </span><span class="s7">$srcContext</span><span class="s0">; </span><span class="s1">++</span><span class="s7">$i</span><span class="s1">) {</span>
            <span class="s7">$src</span><span class="s1">[] = (</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$srcLines</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">]) ? </span><span class="s7">$srcLines</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">] : </span><span class="s9">''</span><span class="s1">).</span><span class="s9">&quot;</span><span class="s0">\n</span><span class="s9">&quot;</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">] ?? </span><span class="s3">false</span><span class="s1">) {</span>
            <span class="s7">$stub </span><span class="s1">= </span><span class="s0">new </span><span class="s3">CutStub</span><span class="s1">(</span><span class="s0">new </span><span class="s1">\</span><span class="s3">stdClass</span><span class="s1">())</span><span class="s0">;</span>
            <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class </span><span class="s1">= (</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">].</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'type'</span><span class="s1">] : </span><span class="s9">''</span><span class="s1">).</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">type </span><span class="s1">= </span><span class="s3">Stub</span><span class="s1">::</span><span class="s3">TYPE_OBJECT</span><span class="s0">;</span>
            <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'cut_hash'</span><span class="s1">] = </span><span class="s3">true</span><span class="s0">;</span>
            <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">] = </span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">]</span><span class="s0">;</span>
            <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">] = </span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">]</span><span class="s0">;</span>

            <span class="s0">try </span><span class="s1">{</span>
                <span class="s7">$caller </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]) ? </span><span class="s0">new </span><span class="s1">\</span><span class="s3">ReflectionMethod</span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'class'</span><span class="s1">]</span><span class="s0">, </span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">]) : </span><span class="s0">new </span><span class="s1">\</span><span class="s3">ReflectionFunction</span><span class="s1">(</span><span class="s7">$frame</span><span class="s1">[</span><span class="s9">'function'</span><span class="s1">])</span><span class="s0">;</span>
                <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class </span><span class="s1">.= </span><span class="s3">ReflectionCaster</span><span class="s1">::</span><span class="s3">getSignature</span><span class="s1">(</span><span class="s3">ReflectionCaster</span><span class="s1">::</span><span class="s3">castFunctionAbstract</span><span class="s1">(</span><span class="s7">$caller</span><span class="s0">, </span><span class="s1">[]</span><span class="s0">, </span><span class="s7">$stub</span><span class="s0">, </span><span class="s3">true</span><span class="s0">, </span><span class="s3">Caster</span><span class="s1">::</span><span class="s3">EXCLUDE_VERBOSE</span><span class="s1">))</span><span class="s0">;</span>

                <span class="s0">if </span><span class="s1">(</span><span class="s7">$f </span><span class="s1">= </span><span class="s7">$caller</span><span class="s1">-&gt;</span><span class="s3">getFileName</span><span class="s1">()) {</span>
                    <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">] = </span><span class="s7">$f</span><span class="s0">;</span>
                    <span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">] = </span><span class="s7">$caller</span><span class="s1">-&gt;</span><span class="s3">getStartLine</span><span class="s1">()</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s0">catch </span><span class="s1">(\</span><span class="s3">ReflectionException </span><span class="s7">$e</span><span class="s1">) {</span>
                <span class="s2">// ignore fake class/function</span>
            <span class="s1">}</span>

            <span class="s7">$srcLines </span><span class="s1">= [</span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">~separator=</span><span class="s0">\0</span><span class="s9">&quot; </span><span class="s1">=&gt; </span><span class="s7">$stub</span><span class="s1">]</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s7">$stub </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
            <span class="s7">$srcLines </span><span class="s1">= []</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s7">$ltrim </span><span class="s1">= </span><span class="s8">0</span><span class="s0">;</span>
        <span class="s0">do </span><span class="s1">{</span>
            <span class="s7">$pad </span><span class="s1">= </span><span class="s3">null</span><span class="s0">;</span>
            <span class="s0">for </span><span class="s1">(</span><span class="s7">$i </span><span class="s1">= </span><span class="s7">$srcContext </span><span class="s1">&lt;&lt; </span><span class="s8">1</span><span class="s0">; </span><span class="s7">$i </span><span class="s1">&gt;= </span><span class="s8">0</span><span class="s0">; </span><span class="s1">--</span><span class="s7">$i</span><span class="s1">) {</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$src</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s7">$ltrim</span><span class="s1">]) &amp;&amp; </span><span class="s9">&quot;</span><span class="s0">\r</span><span class="s9">&quot; </span><span class="s1">!== (</span><span class="s7">$c </span><span class="s1">= </span><span class="s7">$src</span><span class="s1">[</span><span class="s7">$i</span><span class="s1">][</span><span class="s7">$ltrim</span><span class="s1">]) &amp;&amp; </span><span class="s9">&quot;</span><span class="s0">\n</span><span class="s9">&quot; </span><span class="s1">!== </span><span class="s7">$c</span><span class="s1">) {</span>
                    <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">=== </span><span class="s7">$pad</span><span class="s1">) {</span>
                        <span class="s7">$pad </span><span class="s1">= </span><span class="s7">$c</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">((</span><span class="s9">' ' </span><span class="s1">!== </span><span class="s7">$c </span><span class="s1">&amp;&amp; </span><span class="s9">&quot;</span><span class="s0">\t</span><span class="s9">&quot; </span><span class="s1">!== </span><span class="s7">$c</span><span class="s1">) || </span><span class="s7">$pad </span><span class="s1">!== </span><span class="s7">$c</span><span class="s1">) {</span>
                        <span class="s0">break;</span>
                    <span class="s1">}</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
            <span class="s1">++</span><span class="s7">$ltrim</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">while </span><span class="s1">(</span><span class="s8">0 </span><span class="s1">&gt; </span><span class="s7">$i </span><span class="s1">&amp;&amp; </span><span class="s3">null </span><span class="s1">!== </span><span class="s7">$pad</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">--</span><span class="s7">$ltrim</span><span class="s0">;</span>

        <span class="s0">foreach </span><span class="s1">(</span><span class="s7">$src </span><span class="s0">as </span><span class="s7">$i </span><span class="s1">=&gt; </span><span class="s7">$c</span><span class="s1">) {</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s7">$ltrim</span><span class="s1">) {</span>
                <span class="s7">$c </span><span class="s1">= </span><span class="s0">isset</span><span class="s1">(</span><span class="s7">$c</span><span class="s1">[</span><span class="s7">$ltrim</span><span class="s1">]) &amp;&amp; </span><span class="s9">&quot;</span><span class="s0">\r</span><span class="s9">&quot; </span><span class="s1">!== </span><span class="s7">$c</span><span class="s1">[</span><span class="s7">$ltrim</span><span class="s1">] ? </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$c</span><span class="s0">, </span><span class="s7">$ltrim</span><span class="s1">) : </span><span class="s3">ltrim</span><span class="s1">(</span><span class="s7">$c</span><span class="s0">, </span><span class="s9">&quot; </span><span class="s0">\t</span><span class="s9">&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s7">$c </span><span class="s1">= </span><span class="s3">substr</span><span class="s1">(</span><span class="s7">$c</span><span class="s0">, </span><span class="s8">0</span><span class="s0">, </span><span class="s1">-</span><span class="s8">1</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(</span><span class="s7">$i </span><span class="s1">!== </span><span class="s7">$srcContext</span><span class="s1">) {</span>
                <span class="s7">$c </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ConstStub</span><span class="s1">(</span><span class="s9">'default'</span><span class="s0">, </span><span class="s7">$c</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s7">$c </span><span class="s1">= </span><span class="s0">new </span><span class="s3">ConstStub</span><span class="s1">(</span><span class="s7">$c</span><span class="s0">, </span><span class="s7">$stub </span><span class="s1">? </span><span class="s9">'in '</span><span class="s1">.</span><span class="s7">$stub</span><span class="s1">-&gt;</span><span class="s3">class </span><span class="s1">: </span><span class="s9">''</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(</span><span class="s3">null </span><span class="s1">!== </span><span class="s7">$file</span><span class="s1">) {</span>
                    <span class="s7">$c</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'file'</span><span class="s1">] = </span><span class="s7">$file</span><span class="s0">;</span>
                    <span class="s7">$c</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'line'</span><span class="s1">] = </span><span class="s7">$line</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>
            <span class="s7">$c</span><span class="s1">-&gt;</span><span class="s3">attr</span><span class="s1">[</span><span class="s9">'lang'</span><span class="s1">] = </span><span class="s7">$lang</span><span class="s0">;</span>
            <span class="s7">$srcLines</span><span class="s1">[</span><span class="s3">sprintf</span><span class="s1">(</span><span class="s9">&quot;</span><span class="s0">\0</span><span class="s9">~separator= &amp;%d</span><span class="s0">\0</span><span class="s9">&quot;</span><span class="s0">, </span><span class="s7">$i </span><span class="s1">+ </span><span class="s7">$line </span><span class="s1">- </span><span class="s7">$srcContext</span><span class="s1">)] = </span><span class="s7">$c</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s0">return new </span><span class="s3">EnumStub</span><span class="s1">(</span><span class="s7">$srcLines</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>
</pre>
</body>
</html>